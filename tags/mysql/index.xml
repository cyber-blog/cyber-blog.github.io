<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>MYSQL on ä»¿ç”Ÿäººä¼šæ¢¦è§ç”µå­ç¾Šå—ï¼Ÿ</title><link>https://cyber-blog.github.io/tags/mysql/</link><description>Recent content in MYSQL on ä»¿ç”Ÿäººä¼šæ¢¦è§ç”µå­ç¾Šå—ï¼Ÿ</description><generator>Hugo -- gohugo.io</generator><language>zh-ch</language><managingEditor>majiang213@foxmail.com (majiang)</managingEditor><webMaster>majiang213@foxmail.com (majiang)</webMaster><lastBuildDate>Mon, 04 Aug 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://cyber-blog.github.io/tags/mysql/index.xml" rel="self" type="application/rss+xml"/><item><title>MySQL InnoDB ç´¢å¼•æœºåˆ¶ä¸ä¼˜åŒ–</title><link>https://cyber-blog.github.io/p/database-index/</link><pubDate>Mon, 04 Aug 2025 00:00:00 +0000</pubDate><author>majiang213@foxmail.com (majiang)</author><guid>https://cyber-blog.github.io/p/database-index/</guid><description>&lt;h1 id="mysql-innodb-ç´¢å¼•æœºåˆ¶ä¸ä¼˜åŒ–æ‰§è¡Œæµç¨‹è¦†ç›–ç´¢å¼•å›è¡¨ä¸ç´¢å¼•ä¸‹æ¨">MySQL InnoDB ç´¢å¼•æœºåˆ¶ä¸ä¼˜åŒ–ï¼šæ‰§è¡Œæµç¨‹ã€è¦†ç›–ç´¢å¼•ã€å›è¡¨ä¸ç´¢å¼•ä¸‹æ¨
&lt;/h1>&lt;p>InnoDB è¡¨åŸºäº B+ æ ‘å®ç°&lt;strong>èšç°‡ç´¢å¼•&lt;/strong>ï¼ˆä¸»é”®ï¼‰å’Œå¤šä¸ª&lt;strong>äºŒçº§ç´¢å¼•&lt;/strong>ã€‚æŸ¥è¯¢æ—¶ï¼ŒMySQL ä¼˜åŒ–å™¨ä¼šé€‰æ‹©åˆé€‚çš„ç´¢å¼•ï¼Œç„¶åæŒ‰ç…§æ‰§è¡Œæµç¨‹ä¾æ¬¡è¿›è¡Œç´¢å¼•æŸ¥æ‰¾ï¼ˆæ£€ç´¢æ»¡è¶³æ¡ä»¶çš„ç´¢å¼•é¡¹ï¼‰ã€æ¡ä»¶è¿‡æ»¤ã€æ’åºï¼ˆå¦‚æœ‰éœ€è¦ï¼‰å’Œ&lt;strong>å›è¡¨&lt;/strong>ï¼ˆæ ¹æ®äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹çš„ä¸»é”®å€¼æ£€ç´¢å®Œæ•´è¡Œï¼‰ã€‚å¦‚æœæ‰€æœ‰æŸ¥è¯¢åˆ—éƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼ˆè¦†ç›–ç´¢å¼•ï¼‰ï¼Œåˆ™å¯é¿å…å›è¡¨ï¼Œä»è€ŒèŠ‚çœéšæœº IO ï¼›å¦åˆ™éœ€è¦é€šè¿‡ä¸»é”®åˆ°èšç°‡ç´¢å¼•æ£€ç´¢æ•´è¡Œæ•°æ®ï¼ˆå›è¡¨ï¼‰ï¼Œè¿™å¢åŠ äº†é¢å¤–å¼€é”€ ã€‚æ­¤å¤–ï¼ŒInnoDB æ”¯æŒ&lt;strong>ç´¢å¼•æ¡ä»¶ä¸‹æ¨&lt;/strong>ï¼ˆIndex Condition Pushdownï¼ŒICPï¼‰ä¼˜åŒ–ï¼šåœ¨æ‰«æäºŒçº§ç´¢å¼•æ—¶ï¼Œå°†éƒ¨åˆ† WHERE æ¡ä»¶åœ¨å­˜å‚¨å¼•æ“å±‚æå‰è¿‡æ»¤ï¼Œä»è€Œå‡å°‘äº†æ— æ•ˆè¡Œçš„å›è¡¨æ¬¡æ•° ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹å†…å®¹é€šè¿‡å®é™…å»ºè¡¨ã€æŸ¥è¯¢ç¤ºä¾‹å’Œ EXPLAIN åˆ†æï¼Œè¯¦ç»†é˜è¿°ç´¢å¼•åœ¨å„é˜¶æ®µçš„ä½œç”¨ï¼Œæ¯”è¾ƒè¦†ç›–ç´¢å¼•ä¸å›è¡¨çš„å·®å¼‚ï¼Œå¹¶è¯´æ˜ ICP åœ¨æ‰§è¡Œæµç¨‹ä¸­çš„ä½œç”¨ä¸é™åˆ¶ã€‚&lt;/p>
&lt;h2 id="innodb-ç´¢å¼•æŸ¥æ‰¾ä¸æ‰§è¡Œæµç¨‹">&lt;strong>InnoDB ç´¢å¼•æŸ¥æ‰¾ä¸æ‰§è¡Œæµç¨‹&lt;/strong>
&lt;/h2>&lt;p>MySQL æŸ¥è¯¢ç»è¿‡ä¼˜åŒ–å™¨ç¡®å®šæ‰§è¡Œè®¡åˆ’ï¼Œè‹¥ä½¿ç”¨ç´¢å¼•ï¼Œåˆ™æ‰§è¡Œå¼•æ“ä¾æ¬¡è¿›è¡Œï¼š&lt;strong>(1) ç´¢å¼•æŸ¥æ‰¾&lt;/strong>ï¼šæ ¹æ®ç´¢å¼• B+ æ ‘å®šä½æ»¡è¶³å‰ç¼€æ¡ä»¶çš„å¶å­èŠ‚ç‚¹ï¼›&lt;strong>(2) æ¡ä»¶è¿‡æ»¤&lt;/strong>ï¼šå¯¹äºç´¢å¼•æœªèƒ½è¦†ç›–çš„æ¡ä»¶ï¼Œåœ¨å­˜å‚¨å¼•æ“å±‚è¿‡æ»¤ï¼ˆICP å¯æå‰è¿‡æ»¤éƒ¨åˆ†æ¡ä»¶ï¼‰ï¼Œå…¶ä½™æ¡ä»¶æˆ–è®¡ç®—åœ¨æœåŠ¡å™¨å±‚è¿‡æ»¤ï¼›&lt;strong>(3) æ’åº&lt;/strong>ï¼šè‹¥ ORDER BY æ¡ä»¶ä¸ç´¢å¼•é¡ºåºä¸€è‡´ï¼Œåˆ™å¯ä»¥é¡ºåºæ‰«æç´¢å¼•é¿å…é¢å¤–æ’åºï¼›å¦åˆ™ä¼šä½¿ç”¨é¢å¤–çš„æ’åºï¼ˆUsing filesortï¼‰ ï¼›&lt;strong>(4) å›è¡¨&lt;/strong>ï¼šå¦‚æœæŸ¥è¯¢éœ€è¦çš„åˆ—ä¸å…¨åœ¨äºŒçº§ç´¢å¼•ä¸­ï¼Œåˆ™æ ¹æ®ç´¢å¼•å¶å­èŠ‚ç‚¹çš„ä¸»é”®å€¼åˆ°èšç°‡ç´¢å¼•æŸ¥å®Œæ•´è¡Œï¼Œæ­¤è¿‡ç¨‹å³â€œå›è¡¨â€ã€‚æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç´¢å¼•æŸ¥æ‰¾&lt;/strong>ï¼šä¼˜åŒ–å™¨é€‰æ‹©æœ€åˆé€‚çš„ç´¢å¼•ï¼ˆå¦‚å•åˆ—ç´¢å¼•ã€å¤šåˆ—è”åˆç´¢å¼•ï¼‰è¿›è¡ŒæŸ¥æ‰¾ã€‚InnoDB äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å¯¹åº”è¡Œçš„ä¸»é”®å€¼ ï¼Œå› æ­¤å®šä½äºŒçº§ç´¢å¼•æ—¶å¯ç›´æ¥è·å–ä¸»é”®ã€‚&lt;/li>
&lt;li>&lt;strong>æ¡ä»¶è¿‡æ»¤&lt;/strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL æœåŠ¡å™¨å±‚å°†æ‰€æœ‰éç´¢å¼•åˆ—çš„è¿‡æ»¤æ¡ä»¶ç•™åˆ°è·å–å®Œæ•´è¡Œåå¤„ç†ï¼›å¯¹äºç´¢å¼•åˆ—ä¸Šçš„æ¡ä»¶ï¼Œå­˜å‚¨å¼•æ“å¯åœ¨ç´¢å¼•å±‚è¿‡æ»¤ã€‚å¯ç”¨ ICP æ—¶ï¼Œæ»¡è¶³æ¡ä»¶çš„è¡Œå¯ä»¥åœ¨ç´¢å¼•å±‚æå‰æ·˜æ±° ã€‚&lt;/li>
&lt;li>&lt;strong>æ’åº&lt;/strong>ï¼šå¦‚æœæŸ¥è¯¢æ¶‰åŠ ORDER BYï¼Œä¼˜åŒ–å™¨æ£€æŸ¥ç´¢å¼•é¡ºåºæ˜¯å¦å¯ä»¥æŒ‰éœ€æ’åºã€‚è‹¥ç´¢å¼•å‰ç¼€å®Œå…¨åŒ¹é…æ’åºåˆ—å¹¶ä¸”æ— å…¶ä»–æ’åºåˆ—ï¼Œåˆ™æ— éœ€é¢å¤–æ’åºï¼›å¦åˆ™ä¼šäº§ç”Ÿ Using filesort ã€‚&lt;/li>
&lt;li>&lt;strong>å›è¡¨ï¼ˆBookmark Lookupï¼‰&lt;/strong>ï¼šå½“æŸ¥è¯¢åˆ—è¶…å‡ºç´¢å¼•èŒƒå›´æ—¶ï¼Œéœ€è¦å›è¡¨ã€‚InnoDB çš„äºŒçº§ç´¢å¼•åªèƒ½å¿«é€Ÿå®šä½ä¸»é”®å€¼ï¼Œæ•…è‹¥æŸ¥è¯¢è¿˜éœ€å…¶ä»–åˆ—æ•°æ®ï¼Œå°±è¦é€šè¿‡ä¸»é”®åˆ°èšç°‡ç´¢å¼•è¯»å–å®Œæ•´è¡Œï¼Œè¿™å°±æ˜¯å›è¡¨è¿‡ç¨‹ ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç»¼ä¸Šï¼Œä¼˜åŒ–ç´¢å¼•ä»¥è®©æŸ¥è¯¢æ»¡è¶³è¦†ç›–ç´¢å¼•æ¡ä»¶ï¼Œå¯é¿å…å›è¡¨ï¼Œæé«˜æ•ˆç‡ ï¼›å¦åˆ™å›è¡¨æˆä¸ºç“¶é¢ˆã€‚æˆ‘ä»¬ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºè¿™ä¸¤ç§æƒ…å†µã€‚&lt;/p>
&lt;h2 id="è¦†ç›–ç´¢å¼•ä¸å›è¡¨å¯¹æ¯”">&lt;strong>è¦†ç›–ç´¢å¼•ä¸å›è¡¨å¯¹æ¯”&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>è¦†ç›–ç´¢å¼•&lt;/strong>ï¼šè‹¥æŸ¥è¯¢çš„æ‰€æœ‰åˆ—éƒ½åŒ…å«åœ¨ä¸€ä¸ªç´¢å¼•ä¸­ï¼ˆåŒ…æ‹¬äºŒçº§ç´¢å¼•åˆ—åŠéšå«çš„ä¸»é”®åˆ—ï¼‰ï¼Œåˆ™æŸ¥è¯¢å¯ä»¥å®Œå…¨ä»ç´¢å¼•è¯»å–æ‰€éœ€æ•°æ®ï¼Œæ— éœ€è®¿é—®è¡¨æ•°æ® ã€‚EXPLAIN ä¸­ Extra å­—æ®µä¼šæ˜¾ç¤º Using index ã€‚è¿™æ„å‘³ç€ MySQL å¼•æ“ä½¿ç”¨ç´¢å¼•å³å¯å¾—åˆ°ç»“æœï¼Œæ— é¡»è¯»å–è¡¨è¡Œã€‚&lt;/li>
&lt;li>&lt;strong>å›è¡¨&lt;/strong>ï¼šè‹¥æŸ¥è¯¢æ¶‰åŠçš„åˆ—ä¸å…¨åœ¨ç´¢å¼•ä¸­ï¼Œåˆ™å³ä½¿å¯ä»¥ä½¿ç”¨ç´¢å¼•æ£€ç´¢è¡Œä¸»é”®ï¼Œä¹Ÿå¿…é¡»é€šè¿‡ä¸»é”®åˆ°èšç°‡ç´¢å¼•è¯»å‡ºå…¶ä½™åˆ—ï¼Œè¿™ç§°ä¸ºå›è¡¨ã€‚å›è¡¨éœ€è¦é¢å¤–çš„éšæœº I/O å’Œæ—¶é—´ ï¼Œæ€§èƒ½ä½äºçº¯ç´¢å¼•æ‰«æã€‚&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä»¥å®é™…ä¾‹å­è¯´æ˜ã€‚å‡è®¾æœ‰å¦‚ä¸‹è¡¨å’Œç´¢å¼•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">VARCHAR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">VARCHAR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">idx_name_dept&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ENGINE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">InnoDB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;strong>å›è¡¨ç¤ºä¾‹&lt;/strong>ï¼šæŸ¥è¯¢éè¦†ç›–æƒ…å†µéœ€è¦å›è¡¨ã€‚æ¯”å¦‚æŸ¥è¯¢ name=&amp;hellip;ã€dept=&amp;hellip; å’Œ ageï¼ˆæœªåŠ ç´¢å¼•åˆ—ï¼‰ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Alice&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Sales&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¯´æ˜ï¼šç´¢å¼• idx_name_dept(name,dept,salary) å¯ä»¥ç”¨äºæŸ¥æ‰¾ç¬¦åˆ name å’Œ dept çš„è¡Œï¼Œä½†åˆ— age ä¸åœ¨ç´¢å¼•ä¸­ï¼Œå› æ­¤æ¯åŒ¹é…åˆ°ä¸€æ¡è®°å½•åï¼Œéœ€è¦é€šè¿‡ä¸»é”® id å›è¡¨è¯»å– ageã€‚å¯¹åº”çš„æ‰§è¡Œè®¡åˆ’å¯èƒ½å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>id&lt;/strong>&lt;/th>
&lt;th>&lt;strong>select_type&lt;/strong>&lt;/th>
&lt;th>&lt;strong>table&lt;/strong>&lt;/th>
&lt;th>&lt;strong>type&lt;/strong>&lt;/th>
&lt;th>&lt;strong>possible_keys&lt;/strong>&lt;/th>
&lt;th>&lt;strong>key&lt;/strong>&lt;/th>
&lt;th>&lt;strong>key_len&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ref&lt;/strong>&lt;/th>
&lt;th>&lt;strong>rows&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Extra&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>SIMPLE&lt;/td>
&lt;td>demo&lt;/td>
&lt;td>ref&lt;/td>
&lt;td>idx_name_dept&lt;/td>
&lt;td>idx_name_dept&lt;/td>
&lt;td>256&lt;/td>
&lt;td>const,const&lt;/td>
&lt;td>10&lt;/td>
&lt;td>Using where&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>&lt;strong>è§£é‡Š&lt;/strong>ï¼štype=ref è¡¨ç¤ºç”¨äºŒçº§ç´¢å¼•èŒƒå›´æŸ¥æ‰¾ï¼›key=idx_name_deptï¼›Extra æ˜¾ç¤º Using whereï¼Œè¡¨æ˜æœåŠ¡å™¨å±‚éœ€è¦å†æ‰§è¡Œ WHERE æ¡ä»¶è¿‡æ»¤ï¼ˆå°½ç®¡åœ¨æ­¤ä¾‹ä¸­è¿‡æ»¤å®Œæ¯•åè¿˜éœ€å›è¡¨æ£€ç´¢åˆ—ï¼‰ã€‚æ³¨æ„ç”±äº age ä¸åœ¨ç´¢å¼•ä¸­ï¼Œè¿™ä¸æ˜¯è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼Œå› æ­¤ MySQL ä¼šå›è¡¨è·å–å®Œæ•´è¡Œæ‰èƒ½è¿”å› ageã€‚å›è¡¨å¯¼è‡´é¢å¤–å¼€é”€ ã€‚&lt;/li>
&lt;li>&lt;strong>è¦†ç›–ç´¢å¼•ç¤ºä¾‹&lt;/strong>ï¼šè‹¥æŸ¥è¯¢åˆ—éƒ½åœ¨ç´¢å¼•ä¸­ï¼Œåˆ™ä¸å›è¡¨ã€‚ç»§ç»­ä¸Šè¿°è¡¨ç»“æ„ï¼Œå¦‚æœæŸ¥è¯¢åªå– salaryï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Alice&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Sales&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å› ä¸º name, dept, salary æ°å¥½æ˜¯ç´¢å¼• idx_name_dept çš„åˆ—ï¼Œä¸” idï¼ˆä¸»é”®ï¼‰ä¼šéšå¼åŒ…å«åœ¨æ¯ä¸ªç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­ï¼Œæ•…æ­¤æŸ¥è¯¢çš„æ‰€æœ‰åˆ—ï¼ˆname, dept, salary åŠèšç°‡ä¸»é”® idï¼‰å‡å¯ä»ç´¢å¼•ä¸­å–å¾—ï¼Œæ— é¡»å›è¡¨ã€‚æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>id&lt;/strong>&lt;/th>
&lt;th>&lt;strong>select_type&lt;/strong>&lt;/th>
&lt;th>&lt;strong>table&lt;/strong>&lt;/th>
&lt;th>&lt;strong>type&lt;/strong>&lt;/th>
&lt;th>&lt;strong>possible_keys&lt;/strong>&lt;/th>
&lt;th>&lt;strong>key&lt;/strong>&lt;/th>
&lt;th>&lt;strong>key_len&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ref&lt;/strong>&lt;/th>
&lt;th>&lt;strong>rows&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Extra&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>SIMPLE&lt;/td>
&lt;td>demo&lt;/td>
&lt;td>ref&lt;/td>
&lt;td>idx_name_dept&lt;/td>
&lt;td>idx_name_dept&lt;/td>
&lt;td>256&lt;/td>
&lt;td>const,const&lt;/td>
&lt;td>5&lt;/td>
&lt;td>Using index&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>&lt;strong>è§£é‡Š&lt;/strong>ï¼šExtra æ˜¾ç¤º Using index ï¼Œè¡¨ç¤ºæ­¤æŸ¥è¯¢å¯ä»¥ç”±ç´¢å¼•è¦†ç›–æ‰§è¡Œï¼Œä¸éœ€è¦è®¿é—®è¡¨ï¼ˆæ‰€è°“è¦†ç›–ç´¢å¼•ï¼‰ã€‚é€šè¿‡è¦†ç›–ç´¢å¼•ï¼Œé¿å…äº†è¯»èšç°‡ç´¢å¼•çš„éšæœº I/O ï¼ŒæŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸‹è¡¨æ€»ç»“è¦†ç›–ç´¢å¼•ä¸å›è¡¨çš„åŒºåˆ«ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>ç‰¹æ€§&lt;/strong>&lt;/th>
&lt;th>&lt;strong>è¦†ç›–ç´¢å¼•&lt;/strong>&lt;/th>
&lt;th>&lt;strong>å›è¡¨&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>åˆ—éœ€æ±‚&lt;/td>
&lt;td>æŸ¥è¯¢åˆ—å®Œå…¨åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼ˆåŠ ä¸Šä¸»é”®åˆ—ï¼‰&lt;/td>
&lt;td>æŸ¥è¯¢åˆ—ä¸å…¨åœ¨ç´¢å¼•ä¸­&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>I/O è¡Œä¸º&lt;/td>
&lt;td>ç›´æ¥ä»ç´¢å¼•æ ‘è¯»å–æ•°æ®ï¼Œæ— éœ€è®¿é—®è¡¨&lt;/td>
&lt;td>éœ€è¦å…ˆæŸ¥ç´¢å¼•å–ä¸»é”®å€¼ï¼Œå†åˆ°èšç°‡ç´¢å¼•è¯»è¡Œ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EXPLAIN Extra&lt;/td>
&lt;td>Using index&lt;/td>
&lt;td>é€šå¸¸å« Using whereï¼ˆæˆ– Using index conditionï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ€§èƒ½&lt;/td>
&lt;td>æœ€ä¼˜ï¼ˆé¿å…é¢å¤–éšæœº I/Oï¼‰&lt;/td>
&lt;td>è¾ƒå·®ï¼ˆé¢å¤–éšæœº I/O å’Œ CPU è¿‡æ»¤å¼€é”€ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>é€‚ç”¨åœºæ™¯&lt;/td>
&lt;td>æŸ¥è¯¢åˆ—å›ºå®šä¸”å·²ç¼–å…¥ç´¢å¼•ï¼›WHERE/GROUP BY/ORDER BY åˆ—ç´¢å¼•å‰ç¼€&lt;/td>
&lt;td>æŸ¥è¯¢åˆ—è¶…å‡ºç´¢å¼•ï¼›æ— è¦†ç›–ç´¢å¼•éœ€è¡¥åˆ—æ•°æ®&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä»¥ä¸Šç¤ºä¾‹è¯´æ˜ï¼šæ„é€ åˆç†çš„è”åˆç´¢å¼•ï¼Œå°½é‡è®©æŸ¥è¯¢æˆä¸ºè¦†ç›–ç´¢å¼•ï¼ˆå¦‚å°†å¸¸ç”¨çš„è¿‡æ»¤åˆ—å’Œè¿”å›åˆ—åŒ…å«è¿›ç´¢å¼•ï¼‰ï¼Œå¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ ã€‚&lt;/p>
&lt;h2 id="ç´¢å¼•æ¡ä»¶ä¸‹æ¨icpçš„ä½œç”¨ä¸ä½¿ç”¨">&lt;strong>ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ˆICPï¼‰çš„ä½œç”¨ä¸ä½¿ç”¨&lt;/strong>
&lt;/h2>&lt;p>**ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ˆIndex Condition Pushdown, ICPï¼‰**æ˜¯ MySQL 5.6+ ä¸º InnoDB å’Œ MyISAM äºŒçº§ç´¢å¼•è®¾è®¡çš„ä¼˜åŒ–åŠŸèƒ½ ã€‚å½“ä½¿ç”¨äºŒçº§ç´¢å¼•æ£€ç´¢è¡Œæ—¶ï¼Œå¦‚æœæŸ¥è¯¢ä¸­å­˜åœ¨å¤šä¸ªæ¡ä»¶ï¼Œå…¶ä¸­åªæœ‰éƒ¨åˆ†æ¡ä»¶èƒ½åˆ©ç”¨ç´¢å¼•åˆ—ï¼Œåˆ™ MySQL é»˜è®¤ä¼šæŠŠæ»¡è¶³ç´¢å¼•çš„é‚£éƒ¨åˆ†æ¡ä»¶ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“ä¸­è¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘å›è¡¨æ¬¡æ•° ã€‚å…·ä½“è¡Œä¸ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æ—  ICP æ—¶&lt;/strong>ï¼šå­˜å‚¨å¼•æ“æŒ‰ç´¢å¼•æŸ¥åˆ°æ¯ä¸€è¡Œå¯¹åº”çš„ä¸»é”®å€¼å¹¶å›è¡¨ï¼Œç„¶åæœåŠ¡å™¨å±‚å†å¯¹è¿”å›çš„è¡Œæ‰§è¡Œå…¨éƒ¨å‰©ä½™çš„ WHERE æ¡ä»¶è¿‡æ»¤ ã€‚è¿™æ„å‘³ç€å³ä½¿æŸäº›æ¡ä»¶å¯åœ¨ç´¢å¼•å±‚åˆ¤æ–­ï¼Œä¹Ÿè¦ç­‰å›è¡¨åæ‰èƒ½ç­›é€‰ï¼Œå¯¼è‡´å¤§é‡ä¸å¿…è¦çš„è¡Œè¯»å–ã€‚&lt;/li>
&lt;li>&lt;strong>å¯ç”¨ ICP å&lt;/strong>ï¼šå­˜å‚¨å¼•æ“åœ¨æ‰«æç´¢å¼•æ—¶ï¼Œå°†èƒ½å¤Ÿåœ¨ç´¢å¼•åˆ—ä¸Šåˆ¤æ–­çš„æ¡ä»¶æå‰æ‰§è¡Œï¼š&lt;strong>åªæœ‰åœ¨ç´¢å¼•æ¡ä»¶ä¹Ÿæ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œæ‰å›è¡¨è¯»å–è¯¥è¡Œ&lt;/strong> ã€‚å¯¹äºç´¢å¼•å±‚æ— æ³•åˆ¤æ–­ï¼ˆéç´¢å¼•åˆ—æˆ–å‡½æ•°åˆ—ï¼‰çš„æ¡ä»¶ï¼Œå¾…å›è¡¨åå†åœ¨æœåŠ¡å™¨å±‚è¿‡æ»¤ã€‚&lt;/li>
&lt;/ol>
&lt;p>ä¸¾ä¾‹è¯´æ˜ï¼šç»§ç»­ä¸Šè¿° demo è¡¨ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ idx_name_dept(name,dept,salary) æ—¢æœ‰ç´¢å¼•ï¼Œåˆå¯¹åˆ— age æ²¡æœ‰ç´¢å¼•ï¼Œåˆ™è€ƒè™‘å¦‚ä¸‹æŸ¥è¯¢ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Alice&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">50000&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ç´¢å¼• idx_name_dept å¯ç”¨äº name=&amp;lsquo;Alice&amp;rsquo;ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰å’Œ salary &amp;gt; 50000ï¼ˆèŒƒå›´åŒ¹é…ï¼‰ï¼Œä½† age &amp;lt; 30 æ— ç´¢å¼•å‚ä¸ã€‚å¯ç”¨ ICP æ—¶ï¼Œå­˜å‚¨å¼•æ“ä¼šé¦–å…ˆæ ¹æ® name å’Œ salary åœ¨ç´¢å¼•ä¸ŠæŸ¥æ‰¾ä¸»é”®ï¼Œç„¶ååœ¨ç´¢å¼•å±‚åˆ¤æ–­ age &amp;lt; 30 æ¡ä»¶ã€‚å¦‚æœ age ä¸åœ¨ç´¢å¼•ä¸­ï¼Œå°±ä¸èƒ½åœ¨ç´¢å¼•å±‚åˆ¤æ–­ï¼Œæ‰€ä»¥ age &amp;lt; 30 åœ¨ç´¢å¼•å±‚è·³è¿‡ï¼Œè€Œåœ¨å›è¡¨åç”±æœåŠ¡å™¨å±‚æ‰§è¡Œã€‚&lt;/li>
&lt;li>EXPLAIN è¾“å‡ºç¤ºä¾‹å¯èƒ½ä¸ºï¼š&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>id&lt;/strong>&lt;/th>
&lt;th>&lt;strong>select_type&lt;/strong>&lt;/th>
&lt;th>&lt;strong>table&lt;/strong>&lt;/th>
&lt;th>&lt;strong>type&lt;/strong>&lt;/th>
&lt;th>&lt;strong>possible_keys&lt;/strong>&lt;/th>
&lt;th>&lt;strong>key&lt;/strong>&lt;/th>
&lt;th>&lt;strong>key_len&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ref&lt;/strong>&lt;/th>
&lt;th>&lt;strong>rows&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Extra&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>SIMPLE&lt;/td>
&lt;td>demo&lt;/td>
&lt;td>range&lt;/td>
&lt;td>idx_name_dept&lt;/td>
&lt;td>idx_name_dept&lt;/td>
&lt;td>258&lt;/td>
&lt;td>const,const&lt;/td>
&lt;td>15&lt;/td>
&lt;td>Using index condition&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>è¿™é‡Œ Extra æ˜¾ç¤º Using index condition ï¼Œæ„å‘³ç€ ICP è¢«ä½¿ç”¨ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼šâ€œUsing index condition è¯´æ˜ç´¢å¼•æ¡ä»¶ä¸‹æ¨å·²ç»ç”Ÿæ•ˆ â€ã€‚æ­¤æ—¶ MySQL å¼•æ“ä¼šå…ˆåœ¨ç´¢å¼•å±‚åº”ç”¨ name=&amp;lsquo;Alice&amp;rsquo; AND salary&amp;gt;50000 è¿‡æ»¤åŒ¹é…çš„è¡Œï¼Œåªæœ‰æ»¡è¶³è¿™äº›æ¡ä»¶çš„ç´¢å¼•æ¡ç›®æ‰ä¼šè¢«è¯»å–ä¸»é”®ï¼Œå›è¡¨åˆ°ä¸»è¡¨åæœåŠ¡å™¨å†æ£€æŸ¥ age&amp;lt;30ã€‚ç”±æ­¤é¿å…äº†å¯¹ä¸æ»¡è¶³å‰ä¸¤æ¡ä»¶çš„è¡Œè¿›è¡Œå›è¡¨ï¼Œä»è€Œé™ä½äº† I/O å’Œ CPU å¼€é”€ ã€‚å¦‚æœå…³é—­ ICPï¼ˆä¾‹å¦‚æ‰§è¡Œ SET optimizer_switch=&amp;lsquo;index_condition_pushdown=off&amp;rsquo;;ï¼‰ï¼Œåˆ™ EXPLAIN ä¸­ Extra åªä¼šæ˜¾ç¤º Using where ï¼Œæ„å‘³ç€ç´¢å¼•å±‚åªç”¨ name=&amp;lsquo;Alice&amp;rsquo; ç­‰å®šä½ï¼ŒæŸ¥è¯¢è¿”å›çš„æ‰€æœ‰è¡Œéƒ½è¦å›è¡¨å¹¶åœ¨æœåŠ¡å™¨å±‚å†åš age&amp;lt;30 ç­›é€‰ï¼Œæ•ˆç‡è¾ƒä½ã€‚&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;strong>ICP åªå¯¹äºŒçº§ç´¢å¼•æœ‰æ•ˆ&lt;/strong> ã€‚InnoDB çš„èšç°‡ä¸»é”®æ£€ç´¢æ—¶ï¼Œæ•´è¡Œå·²ç»åŠ è½½åˆ°ç¼“å†²åŒºï¼Œæ•…å¯¹ä¸»é”®ç´¢å¼•åº”ç”¨ ICP æ— æ„ä¹‰ã€‚ICP æ¡ä»¶è¦æ±‚å¦‚æ–‡æ¡£æ‰€è¿°ï¼šè®¿é—®æ–¹æ³•ä¸º range/ref/eq_ref/ref_or_nullï¼Œä¸”è¡¨éœ€è¦è®¿é—®å®Œæ•´è¡Œ ã€‚æ­¤å¤–ï¼ŒICP ä¸èƒ½ä¸‹æ¨å­æŸ¥è¯¢å’Œå­˜å‚¨å‡½æ•°ç­‰å¤æ‚æ¡ä»¶ ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤º ICP åœ¨ EXPLAIN è¾“å‡ºä¸­çš„è¡¨ç°ï¼šå‡è®¾ demo è¡¨ä¸­æ•°æ®è¶³å¤Ÿå¤šï¼Œæˆ‘ä»¬æ‰§è¡Œä¸Šé¢æŸ¥è¯¢ï¼ˆå¯ç”¨ ICPï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- å¯ç”¨ICPï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œæ‰§è¡ŒæŸ¥è¯¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dept&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">demo&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Alice&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">50000&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="k">G&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰§è¡Œè®¡åˆ’è§£æï¼ˆç¤ºä¾‹ï¼‰ï¼š&lt;/p>
&lt;ul>
&lt;li>key=idx_name_deptï¼šä½¿ç”¨å¤åˆç´¢å¼•ã€‚&lt;/li>
&lt;li>type=rangeï¼šèŒƒå›´æŸ¥æ‰¾ï¼ˆå› ä¸ºå¯¹ salary &amp;gt; 50000ï¼‰ã€‚&lt;/li>
&lt;li>Extra=Using index condition ï¼šè¯´æ˜å¼•æ“åœ¨ç´¢å¼•å±‚å…ˆåº”ç”¨äº† name å’Œ salary æ¡ä»¶è¿‡æ»¤ï¼Œåç»­å†å›è¡¨æ£€æŸ¥ age æ¡ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ€»ç»“ï¼šICP åœ¨æ‰§è¡Œæµç¨‹ä¸­çš„ä½ç½®åœ¨&lt;strong>ç´¢å¼•æŸ¥æ‰¾åã€å›è¡¨å‰&lt;/strong>ï¼Œèƒ½æœ‰æ•ˆå‡å°‘å›è¡¨æ¬¡æ•° ã€‚åœ¨ EXPLAIN è¾“å‡ºä¸­ï¼ŒUsing index condition è¡¨ç¤º ICP ç”Ÿæ•ˆï¼›è‹¥é¢å¤–å‡ºç° Using whereï¼Œè¯´æ˜ä»æœ‰éç´¢å¼•åˆ—çš„è¿‡æ»¤æ¡ä»¶éœ€åœ¨æœåŠ¡å™¨å±‚å¤„ç† ã€‚ä¾‹å¦‚ä¸Šä¾‹çš„ age&amp;lt;30 å°±å› æœªåœ¨ç´¢å¼•è€Œç•™åœ¨æœåŠ¡å™¨å±‚ã€‚&lt;/p>
&lt;h2 id="ç´¢å¼•ç›¸å…³æ¦‚å¿µå¯¹æ¯”ä¸€è§ˆ">&lt;strong>ç´¢å¼•ç›¸å…³æ¦‚å¿µå¯¹æ¯”ä¸€è§ˆ&lt;/strong>
&lt;/h2>&lt;p>ä¸‹è¡¨å¯¹ç…§äº†æœ¬æ–‡è®¨è®ºçš„å…³é”®æ¦‚å¿µåŠå…¶é€‚ç”¨åœºæ™¯ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>æ¦‚å¿µ&lt;/strong>&lt;/th>
&lt;th>&lt;strong>è§¦å‘æ¡ä»¶&lt;/strong>&lt;/th>
&lt;th>&lt;strong>ä¼˜åŠ¿&lt;/strong>&lt;/th>
&lt;th>&lt;strong>EXPLAIN æ ‡å¿—&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>è¦†ç›–ç´¢å¼•&lt;/strong>&lt;/td>
&lt;td>æŸ¥è¯¢æ‰€éœ€åˆ—å…¨åŒ…å«åœ¨æŸç´¢å¼•ï¼ˆåŒ…æ‹¬ä¸»é”®ï¼‰&lt;/td>
&lt;td>é¿å…å›è¡¨ï¼Œå‡å°‘éšæœº IOï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡&lt;/td>
&lt;td>Using index&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å›è¡¨&lt;/strong>&lt;/td>
&lt;td>æŸ¥è¯¢åˆ—è¶…å‡ºæ‰€ç”¨ç´¢å¼•æ—¶&lt;/td>
&lt;td>æ— &lt;/td>
&lt;td>Using whereï¼ˆæ—  Using indexï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>ç´¢å¼•ä¸‹æ¨ (ICP)&lt;/strong>&lt;/td>
&lt;td>å¤åˆç´¢å¼•æ‰«ææ—¶ï¼Œæœ‰éƒ¨åˆ†æ¡ä»¶éç´¢å¼•åˆ—&lt;/td>
&lt;td>ç´¢å¼•å±‚æå‰è¿‡æ»¤ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°&lt;/td>
&lt;td>Using index condition&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>æ’åº (filesort)&lt;/strong>&lt;/td>
&lt;td>ORDER BY åˆ—æœªæŒ‰ç´¢å¼•é¡ºåºï¼ˆæˆ–æ— åˆé€‚ç´¢å¼•ï¼‰&lt;/td>
&lt;td>æ•°æ®é‡å°æˆ–å†…å­˜è¶³å¤Ÿæ—¶å¼€é”€å¯æ¥å—ï¼Œå°è¡¨ä¹Ÿå¯å¿½ç•¥&lt;/td>
&lt;td>Using filesort&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>è¡¨ä¸­å„é¡¹åˆ†åˆ«å¯¹åº”è¦†ç›–ç´¢å¼•åˆ©ç”¨ç´¢å¼•å…å›è¡¨çš„ä¼˜åŠ¿ ï¼›å›è¡¨çš„è§¦å‘ï¼ˆéè¦†ç›–ï¼‰åœºæ™¯ï¼›ICP é€‚ç”¨æƒ…å†µä¸å¥½å¤„ ï¼›ä»¥åŠæ’åºç›¸å…³çš„æŒ‡æ ‡ Using filesort è¡¨ç¤ºæ’åºåœ¨å†…å­˜æˆ–å¤–éƒ¨è¿›è¡Œ ã€‚&lt;/p>
&lt;h2 id="å®æˆ˜ä¼˜åŒ–å»ºè®®best-practices">&lt;strong>å®æˆ˜ä¼˜åŒ–å»ºè®®ï¼ˆBest Practicesï¼‰&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>è®¾è®¡è¦†ç›–ç´¢å¼•&lt;/strong>ï¼šåˆ†æä¸šåŠ¡æŸ¥è¯¢ï¼Œé’ˆå¯¹å¸¸è§çš„ WHEREã€GROUP BYã€ORDER BY å’Œ SELECT åˆ—ï¼Œè®¾è®¡è”åˆç´¢å¼•ï¼Œä½¿å…¶å°½é‡è¦†ç›–è¿™äº›æŸ¥è¯¢ã€‚è¦†ç›–ç´¢å¼•èƒ½å¤§å¹…å‡å°‘éšæœºè¯»ï¼Œä»è€Œæé€Ÿ ã€‚&lt;/li>
&lt;li>&lt;strong>æ³¨æ„ç´¢å¼•åˆ—é¡ºåº&lt;/strong>ï¼šè”åˆç´¢å¼•ä¸­å°†ç­›é€‰æ¡ä»¶æœ€å¸¸ç”¨çš„åˆ—æ”¾åœ¨æœ€å·¦ä¾§ï¼›åªæœ‰å·¦å‰ç¼€åŒ¹é…æ‰èƒ½æœ‰æ•ˆä½¿ç”¨ç´¢å¼•ã€‚å¤åˆç´¢å¼•å»ºåˆ—é¡ºåºåº”ç¬¦åˆæŸ¥è¯¢é€»è¾‘ï¼Œåˆ‡å‹¿ç›²ç›®å¤šåˆ—ç´¢å¼• ã€‚&lt;/li>
&lt;li>&lt;strong>åˆç†é™åˆ¶ SELECT åˆ—&lt;/strong>ï¼šé¿å… SELECT *ï¼Œåªé€‰å–å¿…è¦åˆ—ã€‚è‹¥æŸ¥è¯¢è¿”å›è¾ƒå°‘åˆ—ï¼Œèƒ½é™ä½å›è¡¨æ¦‚ç‡ï¼Œæˆ–å¯è®©ç´¢å¼•è¦†ç›–æ›´å¤šæŸ¥è¯¢éœ€æ±‚ ã€‚&lt;/li>
&lt;li>&lt;strong>åˆ©ç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’&lt;/strong>ï¼šå®šæœŸæ£€æŸ¥æ…¢æŸ¥è¯¢æˆ–å…³é”®æŸ¥è¯¢çš„ EXPLAIN è¾“å‡ºï¼Œå…³æ³¨ typeã€keyã€rowsã€Extra ç­‰å­—æ®µã€‚è‹¥å‡ºç° Using filesort æˆ–å…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰ç­‰æç¤ºï¼Œè¦è€ƒè™‘åˆ›å»ºç´¢å¼•æˆ–è°ƒæ•´æŸ¥è¯¢é€»è¾‘ã€‚&lt;/li>
&lt;li>&lt;strong>å¯ç”¨ ICPï¼ˆé»˜è®¤å¼€å¯ï¼‰&lt;/strong>ï¼šå¯¹äºèŒƒå›´æŸ¥è¯¢æˆ–å¤šæ¡ä»¶è¿‡æ»¤ï¼ŒEXPLAIN å‡ºç° Using index condition æ—¶è¯´æ˜ ICP æ­£åœ¨å‡å°‘å›è¡¨ã€‚ç¡®è®¤ MySQL ç‰ˆæœ¬ â‰¥5.6ï¼Œä¿æŒ optimizer_switch ä¸­ index_condition_pushdown ä¸º onã€‚æ³¨æ„ICPåªå¯¹äºŒçº§ç´¢å¼•ç”Ÿæ•ˆ ã€‚&lt;/li>
&lt;li>&lt;strong>ç›‘æ§ä¸»é”®è®¾è®¡&lt;/strong>ï¼šä¸»é”®è¶Šé•¿ï¼ŒäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¹Ÿä¼šè¶Šå¤§ï¼ˆå› ä¸ºæ¯æ¡å¶å­è®°å½•éƒ½è¦å­˜å‚¨ä¸»é”®ï¼‰ï¼Œå½±å“ç¼“å­˜å‘½ä¸­å’Œ I/Oã€‚é¿å…åœ¨é«˜é¢‘ä½¿ç”¨çš„è¡¨ä¸Šæ„å»ºè¿‡é•¿çš„ä¸»é”® ã€‚&lt;/li>
&lt;li>&lt;strong>å®šæœŸç»Ÿè®¡ä¸ä¼˜åŒ–&lt;/strong>ï¼šä½¿ç”¨ ANALYZE TABLE ä¿æŒç»Ÿè®¡ä¿¡æ¯å‡†ç¡®ï¼Œç¡®ä¿ä¼˜åŒ–å™¨èƒ½æ­£ç¡®ä¼°ç®—æˆæœ¬ã€‚å¯¹æå°‘æ›´æ–°çš„å¤§è¡¨ï¼Œå¯è€ƒè™‘æ‰‹åŠ¨åˆ†æã€‚é‡‡ç”¨ OPTIMIZE TABLE æˆ–åœ¨çº¿é‡å»ºè¡¨ï¼Œä»¥æ¶ˆé™¤ç¢ç‰‡ã€ç¼©å‡æ•°æ®é¡µã€‚&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡ä¸Šè¿°ç­–ç•¥ï¼Œé…åˆå¯¹ EXPLAIN è¾“å‡ºçš„æ·±å…¥ç†è§£ å’ŒæŒ‡æ ‡è§‚å¯Ÿï¼Œå¯æœ€å¤§åŒ–å‘æŒ¥ InnoDB ç´¢å¼•çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œé¿å…ä¸å¿…è¦çš„å›è¡¨å’Œæ’åºå¼€é”€ï¼Œä»è€Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚&lt;/p></description></item><item><title>Mysql æŸ¥è¯¢æµç¨‹</title><link>https://cyber-blog.github.io/p/mysql-%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B/</link><pubDate>Tue, 24 Oct 2023 00:00:00 +0000</pubDate><author>majiang213@foxmail.com (majiang)</author><guid>https://cyber-blog.github.io/p/mysql-%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B/</guid><description>&lt;h1 id="mysql-ç´¢å¼•ç»“æ„ä¸æ‰§è¡Œæµç¨‹ä»-b-æ ‘åˆ°è”åˆç´¢å¼•ä¸ç´¢å¼•ä¸‹æ¨å…¨è§£æ">&lt;strong>MySQL ç´¢å¼•ç»“æ„ä¸æ‰§è¡Œæµç¨‹ï¼šä» B+ æ ‘åˆ°è”åˆç´¢å¼•ä¸ç´¢å¼•ä¸‹æ¨å…¨è§£æ&lt;/strong>
&lt;/h1>&lt;p>æœ¬ç¯‡æ–‡ç« ä» MySQL ä¸ºä»€ä¹ˆé€‰æ‹© B+ æ ‘ç´¢å¼•å¼€å§‹ï¼Œé€æ­¥å¼•å‡ºè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ã€ç´¢å¼•ä¸‹æ¨ï¼ˆICPï¼‰ã€å›è¡¨æœºåˆ¶å’Œè¦†ç›–ç´¢å¼•ç­‰å…³é”®æ‰§è¡Œç»†èŠ‚ï¼Œå¸®åŠ©ä½ ä»ç»“æ„ã€åŸç†åˆ°å®é™…æ‰§è¡Œè·¯å¾„æ·±å…¥ç†è§£ç´¢å¼•èƒŒåçš„é€»è¾‘ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ä¸€ä¸ºä»€ä¹ˆ-mysql-é€‰æ‹©-b-æ ‘è€Œé-b-æ ‘">&lt;strong>ä¸€ã€ä¸ºä»€ä¹ˆ MySQL é€‰æ‹© B+ æ ‘è€Œé B æ ‘ï¼Ÿ&lt;/strong>
&lt;/h2>&lt;p>MySQL ä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„ InnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ &lt;strong>B+ æ ‘&lt;/strong> ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œè¿™ç§é€‰æ‹©å¹¶éå¶ç„¶ã€‚&lt;/p>
&lt;h3 id="1-b-æ ‘-vs-b-æ ‘-çš„ç»“æ„å·®å¼‚">&lt;strong>1. B æ ‘ vs B+ æ ‘ çš„ç»“æ„å·®å¼‚&lt;/strong>
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>ç‰¹æ€§&lt;/strong>&lt;/th>
&lt;th>&lt;strong>B æ ‘&lt;/strong>&lt;/th>
&lt;th>&lt;strong>B+ æ ‘&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>æ•°æ®å­˜å‚¨&lt;/td>
&lt;td>æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜æ•°æ®&lt;/td>
&lt;td>ä»…å¶å­èŠ‚ç‚¹å­˜æ•°æ®ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜é”®&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æŸ¥è¯¢è·¯å¾„&lt;/td>
&lt;td>æŸ¥è¯¢å¯èƒ½åœ¨ä¸­é—´èŠ‚ç‚¹ç»“æŸ&lt;/td>
&lt;td>æŸ¥è¯¢å¿…é¡»èµ°åˆ°å¶å­èŠ‚ç‚¹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>èŒƒå›´æ‰«æ&lt;/td>
&lt;td>éœ€è¦ä¸­åºéå†æ•´æ£µæ ‘&lt;/td>
&lt;td>å¶å­èŠ‚ç‚¹é€šè¿‡é“¾è¡¨ä¸²è”ï¼Œå¤©ç„¶æ”¯æŒèŒƒå›´æŸ¥è¯¢&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="2-ä¸ºä»€ä¹ˆ-b-æ ‘æ›´é€‚åˆæ•°æ®åº“ç´¢å¼•">&lt;strong>2. ä¸ºä»€ä¹ˆ B+ æ ‘æ›´é€‚åˆæ•°æ®åº“ç´¢å¼•ï¼Ÿ&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>&lt;strong>ç£ç›˜è®¿é—®æ•ˆç‡æ›´é«˜&lt;/strong>ï¼šéå¶å­èŠ‚ç‚¹æ›´å°ï¼Œå†…å­˜ç¼“å­˜å‘½ä¸­ç‡æ›´é«˜ï¼Œå‡å°‘ç£ç›˜ IOï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>èŒƒå›´æŸ¥è¯¢æ›´é«˜æ•ˆ&lt;/strong>ï¼šé“¾è¡¨ä¸²è”å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥é¡ºåºæ‰«æå³å¯ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç»“æ„ç¨³å®šã€æŸ¥è¯¢å‡è¡¡&lt;/strong>ï¼šæ‰€æœ‰æŸ¥æ‰¾éƒ½èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œè·¯å¾„ç»Ÿä¸€ï¼Œä¼˜åŒ–æ›´å®¹æ˜“ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ’åºä¸å…¨è¡¨æ‰«æå‹å¥½&lt;/strong>ï¼šå¤©ç„¶æœ‰åºï¼Œæ”¯æŒå¿«é€Ÿ ORDER BYï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ğŸ“Œ &lt;strong>æ€»ç»“ï¼šB+ æ ‘å¯¹ç£ç›˜ I/Oã€èŒƒå›´æŸ¥ã€ç¼“å­˜å‹å¥½ï¼Œå…¨é¢ä¼˜äº B æ ‘ï¼Œæ˜¯å…³ç³»å‹æ•°æ®åº“çš„é¦–é€‰ã€‚&lt;/strong>&lt;/p>
&lt;hr>
&lt;h2 id="äºŒè”åˆç´¢å¼•ä¸æœ€å·¦åŒ¹é…åŸåˆ™">&lt;strong>äºŒã€è”åˆç´¢å¼•ä¸æœ€å·¦åŒ¹é…åŸåˆ™&lt;/strong>
&lt;/h2>&lt;h3 id="1-ä»€ä¹ˆæ˜¯è”åˆç´¢å¼•">&lt;strong>1. ä»€ä¹ˆæ˜¯è”åˆç´¢å¼•ï¼Ÿ&lt;/strong>
&lt;/h3>&lt;p>è”åˆç´¢å¼•æ˜¯å°†å¤šä¸ªå­—æ®µä½œä¸ºä¸€ä¸ªæ•´ä½“åˆ›å»ºçš„å¤åˆç´¢å¼•ï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">CREATE INDEX idx_abc ON user(a, b, c);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ä½¿ç”¨è”åˆç´¢å¼• (a, b, c) æ—¶ï¼Œä¼šæŠŠæ¯ä¸€è¡Œçš„ aã€bã€c ä½œä¸ºç»„åˆé”® (a, b, c) æ’åºæˆä¸€æ£µ B+ æ ‘ï¼Œå…¶æ¯”è¾ƒé¡ºåºå°±æ˜¯å­—å…¸åºã€‚å®ƒåœ¨ B+ æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šï¼ŒæŒ‰ç…§ a -&amp;gt; b -&amp;gt; c çš„é¡ºåºæ’åˆ—ã€‚&lt;/p>
&lt;p>B+æ ‘ç´¢å¼•ç¤ºä¾‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> Root Node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | (2,1,1) |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-----------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> / \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> / \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +------------------+ +------------------+ â† ä¸­é—´èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | (1,2,1) | | (2,2,1) |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +------------------+ +------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> / \ / \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> / \ / \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Leaf1 Leaf2 Leaf3 Leaf4 â† å¶å­èŠ‚ç‚¹ï¼ˆæœ‰åºé“¾è¡¨ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+ +----------+ +----------+ +----------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|1,1,1 | â†’ |1,1,2 | â†’|1,2,1 | â†’|2,1,1 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----------+ +----------+ +----------+ +----------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +----------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> |2,2,1 | â†’ (å°¾éƒ¨ null)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +----------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-ä¸ºä»€ä¹ˆè¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™">&lt;strong>2. ä¸ºä»€ä¹ˆè¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ&lt;/strong>
&lt;/h3>&lt;p>åªæœ‰&lt;strong>ä»æœ€å·¦ä¾§å­—æ®µå¼€å§‹è¿ç»­ä½¿ç”¨&lt;/strong>ï¼Œç´¢å¼•æ‰èƒ½è¢«åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>WHERE æ¡ä»¶&lt;/strong>&lt;/th>
&lt;th>&lt;strong>æ˜¯å¦å‘½ä¸­ idx_abc&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>WHERE a = 1&lt;/td>
&lt;td>âœ… ä½¿ç”¨ a&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WHERE a = 1 AND b = 2&lt;/td>
&lt;td>âœ… ä½¿ç”¨ aã€b&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WHERE b = 2&lt;/td>
&lt;td>âŒ ä¸ä½¿ç”¨è”åˆç´¢å¼•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WHERE a = 1 AND c = 3&lt;/td>
&lt;td>âœ… ä½¿ç”¨ aï¼Œä½† c ä¸è§¦å‘&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;blockquote>
&lt;p>è”åˆç´¢å¼•ä¸­çš„æ¯”è¾ƒï¼ˆå¦‚ &amp;lt; (2,1,1)ï¼‰æ˜¯åŸºäºè”åˆé”®çš„&lt;strong>å­—å…¸åº&lt;/strong>ï¼Œè€Œæœ€å·¦å‰ç¼€åŸåˆ™åˆ™æ˜¯é™åˆ¶ä½ &lt;strong>å¿…é¡»ä»å‰å¾€ååŒ¹é…å­—æ®µ&lt;/strong>ï¼Œå¦åˆ™ B+ æ ‘æ— æ³•æ­£ç¡®åˆ¤æ–­æœç´¢è·¯å¾„ã€‚&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;h2 id="ä¸‰è”åˆç´¢å¼•æŸ¥è¯¢æ‰§è¡Œæµç¨‹å«å›è¡¨ç´¢å¼•ä¸‹æ¨è¦†ç›–ç´¢å¼•">&lt;strong>ä¸‰ã€è”åˆç´¢å¼•æŸ¥è¯¢æ‰§è¡Œæµç¨‹ï¼ˆå«å›è¡¨ã€ç´¢å¼•ä¸‹æ¨ã€è¦†ç›–ç´¢å¼•ï¼‰&lt;/strong>
&lt;/h2>&lt;p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…æŸ¥è¯¢æ¥è®²è§£å®Œæ•´çš„æ‰§è¡Œæµç¨‹ï¼š&lt;/p>
&lt;h3 id="1-è¡¨ç»“æ„ä¸æŸ¥è¯¢ç¤ºä¾‹">&lt;strong>1. è¡¨ç»“æ„ä¸æŸ¥è¯¢ç¤ºä¾‹&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">CREATE TABLE user (
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> id INT PRIMARY KEY,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> b INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> d VARCHAR(100),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KEY idx_abc (a, b, c)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SELECT c FROM user WHERE a = 1 AND b = 2 AND c &amp;gt; 3;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-æ‰§è¡Œæµç¨‹å«-server-å±‚ä¸-innodb-å±‚åˆ†å·¥">&lt;strong>2. æ‰§è¡Œæµç¨‹ï¼ˆå« Server å±‚ä¸ InnoDB å±‚åˆ†å·¥ï¼‰&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ã€1ã€‘å®¢æˆ·ç«¯å‘é€ SQL æŸ¥è¯¢ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SELECT d FROM t WHERE a = 1 AND c = 2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€2ã€‘Server å±‚ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€ è§£æ SQLï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€ ç¡®è®¤å¯ä»¥ä½¿ç”¨è”åˆç´¢å¼• idx_a_b_cï¼ˆa æ˜¯æœ€å·¦å­—æ®µï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€ åˆ¤æ–­ï¼šc ä¸æ»¡è¶³æœ€å·¦å‰ç¼€ â†’ ä¸èƒ½ç”¨äºå®šä½
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â””â”€ ä½†æ˜¯ âœ… å¯ä»¥ä½¿ç”¨ Index Condition Pushdownï¼ˆICPï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€3ã€‘Server å±‚ä¸‹å‘æ‰§è¡Œè®¡åˆ’ + ä¸‹æ¨è¿‡æ»¤æ¡ä»¶ (c=2) åˆ° InnoDB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€4ã€‘InnoDB äºŒçº§ç´¢å¼•æ‰«æ idx_a_b_cï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€ æ ¹æ® a=1 æ‰«æå¯¹åº”ç´¢å¼•åŒºé—´
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€ å¯¹æ¯ä¸€ä¸ªè®°å½•ï¼Œ**åœ¨æ‰«æç´¢å¼•çš„åŒæ—¶æ£€æŸ¥ c=2**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â””â”€ âœ… æ»¡è¶³ c=2 çš„ä¸»é”® id è¢«ä¿ç•™ï¼Œå…¶ä»–è·³è¿‡ï¼ˆå‡å°‘å›è¡¨ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€5ã€‘è¿”å›åŒ¹é…çš„ä¸»é”® idï¼ˆå¦‚ id=123ã€id=456ï¼‰ç»™ Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€6ã€‘Server å±‚åˆ¤æ–­ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â””â”€ å­—æ®µ d ä¸åœ¨ç´¢å¼•ä¸­ âŒ â†’ å¿…é¡»å›è¡¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€7ã€‘InnoDB æ ¹æ®ä¸»é”® ID å›è¡¨ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”œâ”€ æ£€æŸ¥ä¸»é”®é¡µæ˜¯å¦åœ¨ Buffer Poolï¼ˆç¼“å­˜ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”‚ â””â”€ âœ… åœ¨å†…å­˜ â†’ ç›´æ¥è¯»å–
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â”‚ â””â”€ âŒ ä¸åœ¨å†…å­˜ â†’ è§¦å‘ç£ç›˜ IO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â””â”€ è¿”å›å®Œæ•´è¡Œæ•°æ®ï¼ˆå« d å­—æ®µï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â†“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ã€8ã€‘Server å±‚ç»„è£…æœ€ç»ˆç»“æœï¼Œè¿”å›ç»™å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-æœ¯è¯­è§£æ">&lt;strong>3. æœ¯è¯­è§£æ&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>âœ… &lt;strong>ç´¢å¼•ä¸‹æ¨ï¼ˆICPï¼‰&lt;/strong>ï¼šå°† c &amp;gt; 3 çš„åˆ¤æ–­æå‰åˆ° InnoDB å±‚ï¼Œåœ¨éå†ç´¢å¼•æ—¶å°±è¿‡æ»¤ä¸ç¬¦åˆçš„è¡Œï¼Œé¿å…å¤§é‡æ— æ•ˆå›è¡¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ… &lt;strong>è¦†ç›–ç´¢å¼•&lt;/strong>ï¼šæŸ¥è¯¢å­—æ®µ c å·²ç»åœ¨ç´¢å¼• idx_abc ä¸­ï¼Œç›´æ¥ä»å¶å­èŠ‚ç‚¹è¯»å–ï¼Œæ— éœ€è®¿é—®ä¸»é”®é¡µï¼ˆèšç°‡ç´¢å¼•ï¼‰ï¼Œæé«˜æ•ˆç‡ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âŒ &lt;strong>å›è¡¨&lt;/strong>ï¼šå¦‚æœ SELECT ä¸­åŒ…å«éç´¢å¼•å­—æ®µï¼ˆå¦‚ dï¼‰ï¼Œåˆ™éœ€æ ¹æ®ä¸»é”® id å†å»èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾æ•´è¡Œæ•°æ®ï¼Œå¢åŠ å¼€é”€ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="å››hash-ç´¢å¼•å¯¹æ¯”è¡¥å……é€‚åˆæç«¯ç­‰å€¼æŸ¥è¯¢">&lt;strong>å››ã€Hash ç´¢å¼•å¯¹æ¯”è¡¥å……ï¼šé€‚åˆæç«¯ç­‰å€¼æŸ¥è¯¢&lt;/strong>
&lt;/h2>&lt;h3 id="1-hash-ç´¢å¼•ç‰¹ç‚¹å¤šç”¨äº-memory-å¼•æ“">&lt;strong>1. Hash ç´¢å¼•ç‰¹ç‚¹ï¼ˆå¤šç”¨äº Memory å¼•æ“ï¼‰&lt;/strong>
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>ç‰¹æ€§&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Hash ç´¢å¼•&lt;/strong>&lt;/th>
&lt;th>&lt;strong>B+ æ ‘ç´¢å¼•&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>æŸ¥æ‰¾æ•ˆç‡&lt;/td>
&lt;td>âœ… ç­‰å€¼æŸ¥è¯¢æœ€å¿«&lt;/td>
&lt;td>âœ… ç¨æ…¢ä½†åŠŸèƒ½æ›´å…¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>èŒƒå›´æŸ¥è¯¢&lt;/td>
&lt;td>âŒ ä¸æ”¯æŒ&lt;/td>
&lt;td>âœ… æ”¯æŒ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ’åº&lt;/td>
&lt;td>âŒ ä¸æ”¯æŒ&lt;/td>
&lt;td>âœ… æ”¯æŒï¼ˆå¶å­é“¾è¡¨ï¼‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ”¯æŒå¼•æ“&lt;/td>
&lt;td>ä»… Memoryï¼Œæˆ–è‡ªé€‚åº”å“ˆå¸Œ&lt;/td>
&lt;td>InnoDBã€MyISAMã€Memory ç­‰&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="2-innodb-çš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ahi">&lt;strong>2. InnoDB çš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼ˆAHIï¼‰&lt;/strong>
&lt;/h3>&lt;p>InnoDB ä¼šè‡ªåŠ¨ç›‘æ§æŸäº› B+ æ ‘çƒ­ç‚¹é¡µï¼Œè‡ªåŠ¨ä¸ºå…¶å»ºç«‹ Hash ç´¢å¼•ä»¥ä¼˜åŒ–ç­‰å€¼æŸ¥è¯¢ï¼Œè¿™å¯¹å¼€å‘è€…é€æ˜ã€ä¸å¯æ§åˆ¶ã€‚&lt;/p>
&lt;hr>
&lt;h3 id="äº”innodb-æ— ä¸»é”®è¡¨æ—¶ä¼šå¦‚ä½•æŸ¥è¯¢">&lt;strong>äº”ã€InnoDB æ— ä¸»é”®è¡¨æ—¶ä¼šå¦‚ä½•æŸ¥è¯¢&lt;/strong>
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>è‡ªåŠ¨ç”Ÿæˆéšè—ä¸»é”®&lt;/strong>ï¼š&lt;/p>
&lt;p>è‹¥è¡¨æ— æ˜¾å¼ä¸»é”®æˆ–å”¯ä¸€éç©ºç´¢å¼•ï¼ŒInnoDB ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ª &lt;strong>6å­—èŠ‚éšè— RowID&lt;/strong>ï¼Œä½œä¸ºèšç°‡ç´¢å¼•çš„ keyã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>äºŒçº§ç´¢å¼•æŒ‡å‘ RowID&lt;/strong>ï¼š&lt;/p>
&lt;p>æ‰€æœ‰äºŒçº§ç´¢å¼•å°†æŒ‡å‘è¿™ä¸ªéšè— RowIDï¼Œè€Œä¸æ˜¯æ˜¾å¼ä¸»é”®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æŸ¥è¯¢è¿‡ç¨‹ä¸å›è¡¨&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æŸ¥è¯¢æ—¶å…ˆé€šè¿‡äºŒçº§ç´¢å¼•æŸ¥å‡º RowIDï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç„¶åæ ¹æ® RowID å»èšç°‡ç´¢å¼•ä¸­â€œå›è¡¨â€è·å–æ•´è¡Œæ•°æ®ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¿”å›æ‰€éœ€å­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ€§èƒ½ä¸ç»´æŠ¤å½±å“&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ— æ³•æ§åˆ¶ RowID æ’åºä¸ç»“æ„ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥è¯¢æ•ˆç‡å’Œè°ƒä¼˜éš¾åº¦é«˜äºæœ‰ä¸»é”®è¡¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸åˆ©äºæ•°æ®ç®¡ç†å’Œæ•…éšœæ’æŸ¥ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>å…­ã€Mysql æ·±åˆ†é¡µçš„æŸ¥è¯¢ä¼˜åŒ–æ€»ç»“&lt;/p>
&lt;h2 id="äº”æ€»ç»“ä¸ä¼˜åŒ–å»ºè®®">&lt;strong>äº”ã€æ€»ç»“ä¸ä¼˜åŒ–å»ºè®®&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>âœ… B+ æ ‘ç´¢å¼•æ˜¯æ•°æ®åº“æŸ¥è¯¢çš„æ ¸å¿ƒç»“æ„ï¼ŒèŒƒå›´æŸ¥ã€æ’åºæŸ¥éƒ½ä¾èµ–å®ƒï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ… è”åˆç´¢å¼•éœ€æ³¨æ„â€œæœ€å·¦å‰ç¼€â€åŒ¹é…ï¼Œå­—æ®µé¡ºåºè®¾è®¡æå…³é”®ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ… ICPï¼ˆç´¢å¼•ä¸‹æ¨ï¼‰å¯å‡å°‘å›è¡¨æˆæœ¬ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ… è¦†ç›–ç´¢å¼•æ˜¯æŸ¥è¯¢æœ€ä¼˜å½¢æ€ï¼Œèƒ½é¿å…è®¿é—®ä¸»é”®é¡µï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>âœ… Hash ç´¢å¼•è™½å¿«ï¼Œä½†ä»…é€‚åˆæç®€ç­‰å€¼æŸ¥æ‰¾åœºæ™¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ğŸ“Œ &lt;strong>ä¼˜åŒ–ç´¢å¼•è®¾è®¡çš„æ ¸å¿ƒç­–ç•¥ï¼š&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>é€šè¿‡åˆç†è®¾è®¡è”åˆç´¢å¼•é¡ºåº + ä½¿ç”¨è¦†ç›–ç´¢å¼• + å¯ç”¨ ICP&lt;/p>
&lt;/blockquote>
&lt;p>ä»æ ¹æºä¸Šå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæ‰æ˜¯æå‡ MySQL æŸ¥è¯¢æ€§èƒ½çš„æ ¸å¿ƒã€‚&lt;/p></description></item><item><title>MVCCæ€»ç»“</title><link>https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/</link><pubDate>Thu, 24 Aug 2023 00:00:00 +0000</pubDate><author>majiang213@foxmail.com (majiang)</author><guid>https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/</guid><description>&lt;p>&lt;strong>MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰&lt;/strong>
MVCCï¼ˆMulti-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æ˜¯ä¸€ç§ç”¨äºè§£å†³æ•°æ®åº“ä¸­å¹¶å‘äº‹åŠ¡é—®é¢˜çš„æœºåˆ¶ã€‚å®ƒé€šè¿‡ä¸ºæ¯ä¸ªäº‹åŠ¡æä¾›æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€ä¸ªå¿«ç…§ï¼ˆSnapshotï¼‰ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å–å’Œå†™å…¥æ•°æ®ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„å¹¶å‘æ§åˆ¶å’Œäº‹åŠ¡éš”ç¦»ã€‚&lt;/p>
&lt;p>äº‹åŠ¡æ˜¯ç”± MySQL çš„å¼•æ“æ¥å®ç°çš„ï¼Œæˆ‘ä»¬å¸¸è§çš„ InnoDB å¼•æ“å®ƒæ˜¯æ”¯æŒäº‹åŠ¡çš„ã€‚&lt;/p>
&lt;p>ä¸è¿‡å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½èƒ½æ”¯æŒäº‹åŠ¡ï¼Œæ¯”å¦‚ MySQL åŸç”Ÿçš„ MyISAM å¼•æ“å°±ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¹Ÿæ­£æ˜¯è¿™æ ·ï¼Œæ‰€ä»¥å¤§å¤šæ•° MySQL çš„å¼•æ“éƒ½æ˜¯ç”¨ InnoDBã€‚&lt;/p>
&lt;p>äº‹åŠ¡çœ‹èµ·æ¥æ„Ÿè§‰ç®€å•ï¼Œä½†æ˜¯è¦å®ç°äº‹åŠ¡å¿…é¡»è¦éµå®ˆ 4 ä¸ªç‰¹æ€§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>åŸå­æ€§ï¼ˆAtomicityï¼‰&lt;/strong>ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ï¼Œè€Œä¸”äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ï¼Œå°±å¥½æ¯”ä¹°ä¸€ä»¶å•†å“ï¼Œè´­ä¹°æˆåŠŸæ—¶ï¼Œåˆ™ç»™å•†å®¶ä»˜äº†é’±ï¼Œå•†å“åˆ°æ‰‹ï¼›è´­ä¹°å¤±è´¥æ—¶ï¼Œåˆ™å•†å“åœ¨å•†å®¶æ‰‹ä¸­ï¼Œæ¶ˆè´¹è€…çš„é’±ä¹Ÿæ²¡èŠ±å‡ºå»ã€‚&lt;/li>
&lt;li>&lt;strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰&lt;/strong>ï¼šæ˜¯æŒ‡äº‹åŠ¡æ“ä½œå‰å’Œæ“ä½œåï¼Œæ•°æ®æ»¡è¶³å®Œæ•´æ€§çº¦æŸï¼Œæ•°æ®åº“ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚&lt;/li>
&lt;li>&lt;strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰&lt;/strong>ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ï¼Œå› ä¸ºå¤šä¸ªäº‹åŠ¡åŒæ—¶ä½¿ç”¨ç›¸åŒçš„æ•°æ®æ—¶ï¼Œä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„æ•°æ®ç©ºé—´ï¼Œå¯¹å…¶ä»–å¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹è€…è´­ä¹°å•†å“è¿™ä¸ªäº‹åŠ¡ï¼Œæ˜¯ä¸å½±å“å…¶ä»–æ¶ˆè´¹è€…è´­ä¹°çš„ã€‚&lt;/li>
&lt;li>&lt;strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰&lt;/strong>ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚&lt;/li>
&lt;/ul>
&lt;p>InnoDB å¼•æ“é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ¥ä¿è¯äº‹åŠ¡çš„è¿™å››ä¸ªç‰¹æ€§&lt;/p>
&lt;ul>
&lt;li>æŒä¹…æ€§æ˜¯é€šè¿‡ &lt;code>redo log&lt;/code> ï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ä¿è¯çš„ï¼›&lt;/li>
&lt;li>åŸå­æ€§æ˜¯é€šè¿‡ &lt;code>undo log&lt;/code>ï¼ˆå›æ»šæ—¥å¿—ï¼‰ æ¥ä¿è¯çš„ï¼›&lt;/li>
&lt;li>éš”ç¦»æ€§æ˜¯é€šè¿‡ &lt;code>MVCC&lt;/code>ï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ æˆ–é”æœºåˆ¶æ¥ä¿è¯çš„ï¼›&lt;/li>
&lt;li>ä¸€è‡´æ€§åˆ™æ˜¯é€šè¿‡æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§æ¥ä¿è¯ï¼›&lt;/li>
&lt;/ul>
&lt;h2 id="æ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«">æ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>éš”ç¦»çº§åˆ«&lt;/th>
&lt;th>è„è¯»&lt;/th>
&lt;th>ä¸å¯é‡å¤è¯»&lt;/th>
&lt;th>å¹»è¯»&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>READ UNCOMMITTED&lt;/strong>ï¼šæœªæäº¤è¯»&lt;/td>
&lt;td>å¯èƒ½å‘ç”Ÿ&lt;/td>
&lt;td>å¯èƒ½å‘ç”Ÿ&lt;/td>
&lt;td>å¯èƒ½å‘ç”Ÿ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>READ COMMITTED&lt;/strong>ï¼šå·²æäº¤è¯»&lt;/td>
&lt;td>è§£å†³&lt;/td>
&lt;td>å¯èƒ½å‘ç”Ÿ&lt;/td>
&lt;td>å¯èƒ½å‘ç”Ÿ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>REPEATABLE READ&lt;/strong>ï¼šå¯é‡å¤è¯»&lt;/td>
&lt;td>è§£å†³&lt;/td>
&lt;td>è§£å†³&lt;/td>
&lt;td>å¯èƒ½å‘ç”Ÿ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>SERIALIZABLE&lt;/strong>ï¼šå¯ä¸²è¡ŒåŒ–&lt;/td>
&lt;td>è§£å†³&lt;/td>
&lt;td>è§£å†³&lt;/td>
&lt;td>è§£å†³&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>ä¸ºä»€ä¹ˆæ²¡æœ‰è„å†™ï¼Ÿ&lt;/strong>&lt;br>
å››ç§é—®é¢˜æŒ‰ç…§ä¸¥é‡æ€§æ’åºï¼šè„å†™ &amp;gt; è„è¯» &amp;gt; ä¸å¯é‡å¤è¯» &amp;gt; å¹»è¯»&lt;br>
è„å†™è¿™ä¸ªé—®é¢˜å¤ªä¸¥é‡äº†ï¼Œä¸è®ºæ˜¯å“ªç§éš”ç¦»çº§åˆ«ï¼Œéƒ½ä¸å…è®¸è„å†™çš„æƒ…å†µå‘ç”Ÿã€‚&lt;/p>
&lt;p>SQL æ ‡å‡†æå‡ºäº†å››ç§éš”ç¦»çº§åˆ«æ¥è§„é¿è¿™äº›ç°è±¡ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ€§èƒ½æ•ˆç‡å°±è¶Šä½ï¼Œè¿™å››ä¸ªéš”ç¦»çº§åˆ«å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>è¯»æœªæäº¤ï¼ˆ&lt;em>read uncommitted&lt;/em>ï¼‰&lt;/strong>ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼›&lt;/li>
&lt;li>&lt;strong>è¯»æäº¤ï¼ˆ&lt;em>read committed&lt;/em>ï¼‰&lt;/strong>ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼›&lt;/li>
&lt;li>&lt;strong>å¯é‡å¤è¯»ï¼ˆ&lt;em>repeatable read&lt;/em>ï¼‰&lt;/strong>ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œä¸€ç›´è·Ÿè¿™ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œ&lt;strong>MySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«&lt;/strong>ï¼›&lt;/li>
&lt;li>&lt;strong>ä¸²è¡ŒåŒ–ï¼ˆ&lt;em>serializable&lt;/em>Â ï¼‰&lt;/strong>ï¼›ä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œåœ¨å¤šä¸ªäº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œå¦‚æœå‘ç”Ÿäº†è¯»å†™å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼›&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥ï¼Œè¦è§£å†³è„è¯»ç°è±¡ï¼Œå°±è¦å‡çº§åˆ°ã€Œè¯»æäº¤ã€ä»¥ä¸Šçš„éš”ç¦»çº§åˆ«ï¼›è¦è§£å†³ä¸å¯é‡å¤è¯»ç°è±¡ï¼Œå°±è¦å‡çº§åˆ°ã€Œå¯é‡å¤è¯»ã€çš„éš”ç¦»çº§åˆ«ï¼Œè¦è§£å†³å¹»è¯»ç°è±¡ä¸å»ºè®®å°†éš”ç¦»çº§åˆ«å‡çº§åˆ°ã€Œä¸²è¡ŒåŒ–ã€ã€‚&lt;/p>
&lt;p>ä¸åŒçš„æ•°æ®åº“å‚å•†å¯¹ SQL æ ‡å‡†ä¸­è§„å®šçš„ 4 ç§éš”ç¦»çº§åˆ«çš„æ”¯æŒä¸ä¸€æ ·ï¼Œæœ‰çš„æ•°æ®åº“åªå®ç°äº†å…¶ä¸­å‡ ç§éš”ç¦»çº§åˆ«ï¼Œ&lt;strong>æˆ‘ä»¬è®¨è®ºçš„ MySQL è™½ç„¶æ”¯æŒ 4 ç§éš”ç¦»çº§åˆ«ï¼Œä½†æ˜¯ä¸SQL æ ‡å‡†ä¸­è§„å®šçš„å„çº§éš”ç¦»çº§åˆ«å…è®¸å‘ç”Ÿçš„ç°è±¡å´æœ‰äº›å‡ºå…¥&lt;/strong>ã€‚&lt;/p>
&lt;p>MySQL åœ¨ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿï¼ˆæ³¨æ„æ˜¯å¾ˆå¤§ç¨‹åº¦é¿å…ï¼Œå¹¶ä¸æ˜¯å½»åº•é¿å…ï¼‰ï¼Œæ‰€ä»¥ MySQL å¹¶ä¸ä¼šä½¿ç”¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«æ¥é¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿï¼Œå› ä¸ºä½¿ç”¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«ä¼šå½±å“æ€§èƒ½ã€‚&lt;/p>
&lt;p>&lt;strong>MySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†æ˜¯å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡ï¼ˆå¹¶ä¸æ˜¯å®Œå…¨è§£å†³äº†&lt;/strong>ã€‚è§£å†³çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>é’ˆå¯¹&lt;strong>å¿«ç…§è¯»&lt;/strong>ï¼ˆæ™®é€š select è¯­å¥ï¼‰ï¼Œæ˜¯&lt;strong>é€šè¿‡ MVCC æ–¹å¼è§£å†³äº†å¹»è¯»&lt;/strong>ï¼Œå› ä¸ºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œä¸€ç›´è·Ÿè¿™ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œå³ä½¿ä¸­é€”æœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ˜¯æŸ¥è¯¢ä¸å‡ºæ¥è¿™æ¡æ•°æ®çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½äº†é¿å…å¹»è¯»é—®é¢˜ã€‚&lt;/li>
&lt;li>é’ˆå¯¹&lt;strong>å½“å‰è¯»&lt;/strong>ï¼ˆselect &amp;hellip; for update ç­‰è¯­å¥ï¼‰ï¼Œæ˜¯&lt;strong>é€šè¿‡ next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»&lt;/strong>ï¼Œå› ä¸ºå½“æ‰§è¡Œ select &amp;hellip; for update è¯­å¥çš„æ—¶å€™ï¼Œä¼šåŠ ä¸Š next-key lockï¼Œå¦‚æœæœ‰å…¶ä»–äº‹åŠ¡åœ¨ next-key lock é”èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’å…¥è¯­å¥å°±ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æˆåŠŸæ’å…¥ï¼Œæ‰€ä»¥å°±å¾ˆå¥½äº†é¿å…å¹»è¯»é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="éš”ç¦»çº§åˆ«å®ç°æ–¹å¼">éš”ç¦»çº§åˆ«å®ç°æ–¹å¼
&lt;/h3>&lt;ul>
&lt;li>å¯¹äºã€Œè¯»æœªæäº¤ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå› ä¸ºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–æœ€æ–°çš„æ•°æ®å°±å¥½äº†ï¼›&lt;/li>
&lt;li>å¯¹äºã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œé€šè¿‡åŠ è¯»å†™é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ï¼›&lt;/li>
&lt;li>å¯¹äºã€Œè¯»æäº¤ã€å’Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå®ƒä»¬æ˜¯é€šè¿‡Â &lt;strong>Read ViewÂ æ¥å®ç°çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºåˆ›å»º Read View çš„æ—¶æœºä¸åŒï¼Œå¤§å®¶å¯ä»¥æŠŠ Read View ç†è§£æˆä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå°±åƒç›¸æœºæ‹ç…§é‚£æ ·ï¼Œå®šæ ¼æŸä¸€æ—¶åˆ»çš„é£æ™¯ã€‚&lt;/strong>ã€Œè¯»æäº¤ã€éš”ç¦»çº§åˆ«æ˜¯åœ¨ã€Œæ¯ä¸ªè¯­å¥æ‰§è¡Œå‰ã€éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œè€Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯åŠ¨äº‹åŠ¡æ—¶ã€ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read View**ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="read-view">Read View
&lt;/h2>&lt;p>Read View ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤éƒ¨åˆ†ç»„æˆï¼š&lt;/p>
&lt;ul>
&lt;li>Read View ä¸­å››ä¸ªå­—æ®µä½œç”¨ï¼›&lt;/li>
&lt;li>èšç°‡ç´¢å¼•è®°å½•ä¸­ä¸¤ä¸ªè·Ÿäº‹åŠ¡æœ‰å…³çš„éšè—åˆ—ï¼›&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/readview%E7%BB%93%E6%9E%84.drawio.webp"
width="900"
height="437"
srcset="https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/readview%E7%BB%93%E6%9E%84.drawio_hu9031801013325448962.webp 480w, https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/readview%E7%BB%93%E6%9E%84.drawio_hu14455649638736036759.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="205"
data-flex-basis="494px"
>&lt;/p>
&lt;p>Read View æœ‰å››ä¸ªé‡è¦çš„å­—æ®µï¼š&lt;/p>
&lt;ul>
&lt;li>m_ids ï¼šæŒ‡çš„æ˜¯åœ¨åˆ›å»º Read View æ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€çš„&lt;strong>äº‹åŠ¡ id åˆ—è¡¨&lt;/strong>ï¼Œæ³¨æ„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ&lt;strong>â€œæ´»è·ƒäº‹åŠ¡â€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤çš„äº‹åŠ¡&lt;/strong>ã€‚&lt;/li>
&lt;li>min_trx_id ï¼šæŒ‡çš„æ˜¯åœ¨åˆ›å»º Read View æ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€ä¸­äº‹åŠ¡Â &lt;strong>id æœ€å°çš„äº‹åŠ¡&lt;/strong>ï¼Œä¹Ÿå°±æ˜¯ m_ids çš„æœ€å°å€¼ã€‚&lt;/li>
&lt;li>max_trx_id ï¼šè¿™ä¸ªå¹¶ä¸æ˜¯ m_ids çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯&lt;strong>åˆ›å»º Read View æ—¶å½“å‰æ•°æ®åº“ä¸­åº”è¯¥ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ id å€¼&lt;/strong>ï¼Œä¹Ÿå°±æ˜¯å…¨å±€äº‹åŠ¡ä¸­æœ€å¤§çš„äº‹åŠ¡ id å€¼ + 1ï¼›&lt;/li>
&lt;li>creator_trx_id ï¼šæŒ‡çš„æ˜¯&lt;strong>åˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡çš„äº‹åŠ¡ id&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¯¹äºä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“çš„æ•°æ®åº“è¡¨ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­éƒ½åŒ…å«ä¸‹é¢ä¸¤ä¸ªéšè—åˆ—ï¼š&lt;/p>
&lt;ul>
&lt;li>trx_idï¼Œå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±ä¼š&lt;strong>æŠŠè¯¥äº‹åŠ¡çš„äº‹åŠ¡ id è®°å½•åœ¨ trx_id éšè—åˆ—é‡Œ&lt;/strong>ï¼›&lt;/li>
&lt;li>roll_pointerï¼Œæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„è®°å½•å†™å…¥åˆ° undo æ—¥å¿—ä¸­ï¼Œç„¶å&lt;strong>è¿™ä¸ªéšè—åˆ—æ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬è®°å½•&lt;/strong>ï¼Œäºæ˜¯å°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°ä¿®æ”¹å‰çš„è®°å½•ã€‚&lt;/li>
&lt;li>row_idï¼Œè¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•ï¼ˆå¦‚æœå®šä¹‰ä¸»é”®ï¼Œå®ƒå°±æ²¡æœ‰å•¦ï¼‰&lt;/li>
&lt;/ul>
&lt;p>åœ¨åˆ›å»º Read View åï¼Œæˆ‘ä»¬å¯ä»¥å°†è®°å½•ä¸­çš„ trx_id åˆ’åˆ†è¿™ä¸‰ç§æƒ…å†µï¼š&lt;/p>
&lt;p>&lt;img src="https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/ReadView.drawio.webp"
width="707"
height="332"
srcset="https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/ReadView.drawio_hu4707241512921782630.webp 480w, https://cyber-blog.github.io/p/mvcc%E6%80%BB%E7%BB%93/ReadView.drawio_hu12158190206219245288.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="212"
data-flex-basis="511px"
>&lt;/p>
&lt;p>ä¸€ä¸ªäº‹åŠ¡å»è®¿é—®è®°å½•çš„æ—¶å€™ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°è®°å½•æ€»æ˜¯å¯è§ä¹‹å¤–ï¼Œè¿˜æœ‰è¿™å‡ ç§æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœè®°å½•çš„ trx_id å€¼å°äº Read View ä¸­çš„Â &lt;code>min_trx_id&lt;/code>Â å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨åˆ›å»º Read ViewÂ &lt;strong>å‰&lt;/strong>å·²ç»æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡&lt;strong>å¯è§&lt;/strong>ã€‚&lt;/li>
&lt;li>å¦‚æœè®°å½•çš„ trx_id å€¼å¤§äºç­‰äº Read View ä¸­çš„Â &lt;code>max_trx_id&lt;/code>Â å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨åˆ›å»º Read ViewÂ &lt;strong>å&lt;/strong>æ‰å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡&lt;strong>ä¸å¯è§&lt;/strong>ã€‚&lt;/li>
&lt;li>å¦‚æœè®°å½•çš„ trx_id å€¼åœ¨ Read View çš„Â &lt;code>min_trx_id&lt;/code>Â å’ŒÂ &lt;code>max_trx_id&lt;/code>Â ä¹‹é—´ï¼Œéœ€è¦åˆ¤æ–­ trx_id æ˜¯å¦åœ¨ m_ids åˆ—è¡¨ä¸­ï¼š
&lt;ul>
&lt;li>å¦‚æœè®°å½•çš„ trx_idÂ &lt;strong>åœ¨&lt;/strong>Â &lt;code>m_ids&lt;/code>Â åˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥ç‰ˆæœ¬è®°å½•çš„æ´»è·ƒäº‹åŠ¡ä¾ç„¶æ´»è·ƒç€ï¼ˆè¿˜æ²¡æäº¤äº‹åŠ¡ï¼‰ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡&lt;strong>ä¸å¯è§&lt;/strong>ã€‚&lt;/li>
&lt;li>å¦‚æœè®°å½•çš„ trx_idÂ &lt;strong>ä¸åœ¨&lt;/strong>Â &lt;code>m_ids&lt;/code>åˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥ç‰ˆæœ¬è®°å½•çš„æ´»è·ƒäº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡&lt;strong>å¯è§&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>è¿™ç§é€šè¿‡ã€Œç‰ˆæœ¬é“¾ã€æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡è®¿é—®åŒä¸€ä¸ªè®°å½•æ—¶çš„è¡Œä¸ºå°±å« MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å¯¹äºå¯é‡å¤è¯»&lt;/strong>
&lt;strong>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«æ˜¯å¯åŠ¨äº‹åŠ¡æ—¶ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read View&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>å¯¹äºè¯»å·²æäº¤&lt;/strong>
&lt;strong>è¯»æäº¤éš”ç¦»çº§åˆ«æ˜¯åœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Read View&lt;/strong>ã€‚&lt;/p></description></item></channel></rss>