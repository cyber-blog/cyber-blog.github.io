<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Python on ä»¿ç”Ÿäººä¼šæ¢¦è§ç”µå­ç¾Šå—ï¼Ÿ</title><link>https://cyber-blog.github.io/tags/python/</link><description>Recent content in Python on ä»¿ç”Ÿäººä¼šæ¢¦è§ç”µå­ç¾Šå—ï¼Ÿ</description><generator>Hugo -- gohugo.io</generator><language>zh-ch</language><managingEditor>majiang213@foxmail.com (majiang)</managingEditor><webMaster>majiang213@foxmail.com (majiang)</webMaster><lastBuildDate>Fri, 12 Jul 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://cyber-blog.github.io/tags/python/index.xml" rel="self" type="application/rss+xml"/><item><title>åŸºäº MMS æ¨¡å‹çš„å°å°¼è¯­å¾®è°ƒ</title><link>https://cyber-blog.github.io/p/finetune-vits-mms-id/</link><pubDate>Fri, 12 Jul 2024 00:00:00 +0000</pubDate><author>majiang213@foxmail.com (majiang)</author><guid>https://cyber-blog.github.io/p/finetune-vits-mms-id/</guid><description>&lt;img src="https://cyber-blog.github.io/p/finetune-vits-mms-id/cover.png" alt="Featured image of post åŸºäº MMS æ¨¡å‹çš„å°å°¼è¯­å¾®è°ƒ" />&lt;p>VITS æ˜¯ä¸€ç§ç”¨äºè‹±è¯­æ–‡æœ¬è½¬è¯­éŸ³ ï¼ˆTTSï¼‰ çš„è½»é‡çº§ã€ä½å»¶è¿Ÿæ¨¡å‹ã€‚
å¤§è§„æ¨¡å¤šè¯­è¨€è¯­éŸ³ ï¼ˆMMSï¼‰ æ˜¯ VITS çš„å¤šè¯­è¨€ TTS æ‰©å±•ï¼Œæ”¯æŒ 1100 å¤šç§è¯­è¨€ã€‚&lt;/p>
&lt;p>ä¸¤è€…éƒ½ä½¿ç”¨ç›¸åŒçš„åº•å±‚ VITS æ¶æ„ï¼Œç”±ä¸€ä¸ªé‰´åˆ«å™¨å’Œä¸€ä¸ªç”¨äºåŸºäº GAN çš„è®­ç»ƒçš„ç”Ÿæˆå™¨ç»„æˆã€‚å®ƒä»¬çš„æ ‡è®°å™¨ä¸åŒï¼šVITS æ ‡è®°å™¨å°†è‹±è¯­è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºéŸ³ç´ ï¼Œè€Œ MMS æ ‡è®°å™¨å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºåŸºäºå­—ç¬¦çš„æ ‡è®°ã€‚&lt;/p>
&lt;p>å¦‚æœè¦ä½¿ç”¨å®½æ¾çš„è‹±è¯­ TTS æ¨¡å‹ï¼Œåˆ™åº”å¾®è°ƒåŸºäº VITS çš„ checkpointï¼Œå¹¶é’ˆå¯¹æ‰€æœ‰å…¶ä»–æƒ…å†µå¾®è°ƒåŸºäº MMS çš„æ£€æŸ¥ç‚¹ã€‚
é’ˆå¯¹å°å°¼è¯­çš„è®­ç»ƒé€‰æ‹© &lt;a class="link" href="https://huggingface.co/fadhilamri/mms-tts-ind-train" target="_blank" rel="noopener"
>mms-tts-ind-train&lt;/a>checkpoint&lt;/p>
&lt;p>ç»“åˆæ­£ç¡®çš„æ•°æ®å’Œä»¥ä¸‹è®­ç»ƒæ–¹æ³•ï¼Œæ‚¨å¯ä»¥åœ¨ 20 åˆ†é’Ÿå†…è·å¾—æ¯ä¸ª VITS/MMS æ£€æŸ¥ç‚¹çš„å‡ºè‰²å¾®è°ƒç‰ˆæœ¬ï¼Œåªéœ€ 80 åˆ° 150 ä¸ªæ ·æœ¬ã€‚&lt;/p>
&lt;p>å¾®è°ƒ VITS æˆ– MMS éœ€è¦æŒ‰è¿ç»­é¡ºåºå®Œæˆå¤šä¸ªé˜¶æ®µï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits?tab=readme-ov-file#1-requirements" target="_blank" rel="noopener"
>Install requirements&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits?tab=readme-ov-file#2-model-selection" target="_blank" rel="noopener"
>Choose or create the initial model&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits?tab=readme-ov-file#3-finetuning" target="_blank" rel="noopener"
>Finetune the model&lt;/a>Â &lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits?tab=readme-ov-file#4-inference" target="_blank" rel="noopener"
>Optional - how to use the finetuned model&lt;/a>&lt;/li>
&lt;/ol>
&lt;h4 id="å®‰è£…-requirements">å®‰è£… requirements
&lt;/h4>&lt;ol start="0">
&lt;li>å…‹éš†ä»“åº“å¹¶ installï¼Œç¡®ä¿&lt;code>python &amp;gt;= 3.10&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">git&lt;/span> &lt;span class="n">clone&lt;/span> &lt;span class="n">git&lt;/span>&lt;span class="nd">@github.com&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ylacombe&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">finetune&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hf&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vits&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">git&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="n">finetune&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hf&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vits&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span> &lt;span class="n">requirements&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>é“¾æ¥æ‚¨çš„ Hugging Face å¸æˆ·ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨ Hub ä¸Šæ‹‰å–/æ¨é€æ¨¡å‹ä»“åº“ã€‚è¿™å°†ä½¿æ‚¨èƒ½å¤Ÿåœ¨ Hub ä¸Šä¿å­˜å¾®è°ƒçš„æƒé‡ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¸ç¤¾åŒºå…±äº«å®ƒä»¬å¹¶è½»æ¾é‡å¤ä½¿ç”¨å®ƒä»¬ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">git config --global credential.helper store
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">huggingface-cli login
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>ç„¶åè¾“å…¥ &lt;a class="link" href="https://huggingface.co/settings/tokens" target="_blank" rel="noopener"
>https://huggingface.co/settings/tokens&lt;/a> çš„èº«ä»½éªŒè¯ä»¤ç‰Œã€‚å¦‚æœè¿˜æ²¡æœ‰ä»¤ç‰Œï¼Œè¯·åˆ›å»ºä¸€ä¸ªæ–°ä»¤ç‰Œã€‚æ‚¨åº”ç¡®ä¿æ­¤ä»¤ç‰Œå…·æœ‰â€œå†™å…¥â€æƒé™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ Cython æ„å»º&lt;code>monotonic alignment search function&lt;/code>ã€‚è¿™æ˜¯ç»å¯¹å¿…è¦çš„ï¼Œå› ä¸º Python åŸç”Ÿç‰ˆæœ¬éå¸¸æ…¢ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Cython-version Monotonoic Alignment Search&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> monotonic_align
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir monotonic_align
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python setup.py build_ext --inplace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ..
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>ï¼ˆå¯é€‰ï¼‰å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯åŸå§‹ VITS æ£€æŸ¥ç‚¹ï¼Œè€Œä¸æ˜¯ MMS æ£€æŸ¥ç‚¹ï¼Œè¯·å®‰è£…&lt;code>phonemizer&lt;/code>ã€‚
æŒ‰ç…§&lt;a class="link" href="https://bootphon.github.io/phonemizer/install.html" target="_blank" rel="noopener"
>æ­¤å¤„&lt;/a>æŒ‡ç¤ºçš„æ­¥éª¤æ“ä½œã€‚
ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ Debian/Unbuntu ä¸Šï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Install dependencies&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install festival espeak-ng mbrola
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Install phonemizer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip install phonemizer
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;pre>&lt;code>æ›´å¤šç»†èŠ‚
æŸäº›è¯­è¨€è¦æ±‚åœ¨å°†æ–‡æœ¬æä¾›ç»™Â `VitsTokenizer`Â ä¹‹å‰ä½¿ç”¨Â `uroman`ï¼Œå› ä¸ºç›®å‰åˆ†è¯å™¨æœ¬èº«ä¸æ”¯æŒæ‰§è¡Œé¢„å¤„ç†ã€‚
ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å°† uroman ä»“åº“å…‹éš†åˆ°æœ¬åœ°è®¡ç®—æœºï¼Œå¹¶å°† bash å˜é‡ UROMAN è®¾ç½®ä¸ºæœ¬åœ°è·¯å¾„ï¼š
&lt;/code>&lt;/pre>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/isi-nlp/uroman.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> uroman
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">UROMAN&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;pre>&lt;code>å‰©ä¸‹çš„å°±æ˜¯ç”±è®­ç»ƒè„šæœ¬æ¥å¤„ç†äº†ã€‚
&lt;/code>&lt;/pre>
&lt;h4 id="é€‰æ‹©æ¨¡å‹">é€‰æ‹©æ¨¡å‹
&lt;/h4>&lt;p>å¦‚æœéœ€è¦çš„ &lt;code>checkpoint&lt;/code> å·²ç»å­˜åœ¨ã€‚&lt;/p>
&lt;p>ç›®å‰ä¸€äº›&lt;code>checkpoint&lt;/code>å·²ç»å¯ç”¨ï¼Œå‚ç…§å¦‚ä¸‹åˆ—è¡¨å¯ä»¥åœ¨ Hugging Face æœç´¢
å¯ä»¥åˆ—è¡¨&lt;/p>
&lt;ul>
&lt;li>English
&lt;ul>
&lt;li>&lt;code>ylacombe/vits-ljs-with-discriminator&lt;/code>Â (ç¡®ä¿Â &lt;a class="link" href="https://bootphon.github.io/phonemizer/install.html" target="_blank" rel="noopener"
>phonemizer&lt;/a>å·²å®‰è£…) - éå¸¸é€‚åˆå•ä¸€å£°éŸ³å¾®è°ƒ&lt;/li>
&lt;li>&lt;code>ylacombe/vits-vctk-with-discriminator&lt;/code>Â (ç¡®ä¿Â &lt;a class="link" href="https://bootphon.github.io/phonemizer/install.html" target="_blank" rel="noopener"
>phonemizer&lt;/a>å·²å®‰è£…) - é€‚ç”¨äºå¤šå£°éŸ³è‹±è¯­å¾®è°ƒã€‚&lt;/li>
&lt;li>&lt;code>ylacombe/mms-tts-eng-train&lt;/code>Â - å¦‚æœæ‚¨æƒ³é¿å…ä½¿ç”¨Â &lt;code>phonemizer&lt;/code>Â åŒ…ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Spanish -Â &lt;code>ylacombe/mms-tts-spa-train&lt;/code>Â è¥¿ç­ç‰™è¯­&lt;/li>
&lt;li>Korean -Â &lt;code>ylacombe/mms-tts-kor-train&lt;/code>Â éŸ©è¯­&lt;/li>
&lt;li>Marathi -Â &lt;code>ylacombe/mms-tts-mar-train&lt;/code>Â é©¬æ‹‰åœ°è¯­&lt;/li>
&lt;li>Tamil -Â &lt;code>ylacombe/mms-tts-tam-train&lt;/code>Â æ³°ç±³å°”è¯­&lt;/li>
&lt;li>Gujarati -Â &lt;code>ylacombe/mms-tts-guj-train&lt;/code>Â å¤å‰æ‹‰ç‰¹è¯­
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æ‰¾åˆ°äº†æ­£ç¡®çš„æ£€æŸ¥ç‚¹ï¼Œè®°ä¸‹å­˜å‚¨åº“åç§°å¹¶ç›´æ¥ä¼ é€’åˆ°ä¸‹ä¸€æ­¥ğŸ¤—ã€‚
åœ¨è¿™é‡Œæˆ‘é€‰æ‹©äº† &lt;code>fadhilamri/mms-tts-ind-train&lt;/code>ğŸ¥³ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœéœ€è¦çš„éœ€è¦å¾®è°ƒçš„è¯­è¨€ &lt;code>checkpoint&lt;/code> ä¸å­˜åœ¨ï¼Œè¯·å‚è€ƒ&lt;a class="link" href="https://huggingface.co/dhavalgala/mms-tts-ind-train" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>åˆ›å»ºå¯¹åº”è¯­è¨€çš„&lt;code>checkpoint&lt;/code>ã€‚&lt;/p>
&lt;h4 id="å¾®è°ƒ">å¾®è°ƒ
&lt;/h4>&lt;p>ä½¿ç”¨ json é…ç½®æ–‡ä»¶å¯ä»¥è¿è¡Œå¾®è°ƒè„šæœ¬ï¼Œä¸¤ç§æ–¹æ³•éƒ½ä½¿ç”¨å‘½ä»¤è¡Œã€‚è¯·æ³¨æ„ï¼Œæ‚¨åªéœ€è¦ä¸€ä¸ª GPU å³å¯å¾®è°ƒ VITS/MMSï¼Œå› ä¸ºæ¨¡å‹éå¸¸è½»å·§ï¼ˆ83M å‚æ•°ï¼‰,æ ¹æ®æ•°æ®é›†çš„å¤§å°å¯¹æ˜¾å­˜çš„éœ€æ±‚æœ‰è¾ƒå¤§å˜åŒ–ï¼Œæˆ‘çš„æ•°æ®é›†å¤§å°æ˜¯&lt;code>602MB&lt;/code>ã€éœ€è¦ 21GB æ˜¾å­˜å·¦å³ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Note
ä½¿ç”¨é…ç½®æ–‡ä»¶æ˜¯ä½¿ç”¨å¾®è°ƒè„šæœ¬çš„é¦–é€‰æ–¹å¼ï¼Œå› ä¸ºå®ƒåŒ…å«è¦è€ƒè™‘çš„æœ€é‡è¦çš„å‚æ•°ã€‚æœ‰å…³å‚æ•°çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·è¿è¡ŒÂ &lt;code>python run_vits_finetuning.py --help&lt;/code>ã€‚è¯·æ³¨æ„ï¼Œè®­ç»ƒè„šæœ¬ä¸ä¼šå¿½ç•¥æŸäº›å‚æ•°ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits/blob/main/training_config_examples" target="_blank" rel="noopener"
>training_config_examples&lt;/a>æ–‡ä»¶å¤¹åŒ…å«é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ã€‚ä¸€æ—¦å¯¹æ‚¨çš„é…ç½®æ–‡ä»¶æ„Ÿåˆ°æ»¡æ„ï¼Œæ‚¨å°±å¯ä»¥å¾®è°ƒæ¨¡å‹ã€‚&lt;/p>
&lt;p>è¦è€ƒè™‘çš„é‡è¦å‚æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸å·¥ä»¶ç›¸å…³çš„æ‰€æœ‰å†…å®¹ï¼š&lt;code>project_name&lt;/code>Â å’Œè¾“å‡ºç›®å½• ï¼ˆ&lt;code>hub_model_id&lt;/code>ï¼ŒÂ &lt;code>output_dir&lt;/code>ï¼‰ï¼Œç”¨äºè·Ÿè¸ªæ¨¡å‹ã€‚&lt;/li>
&lt;li>éœ€è¦å¾®è°ƒçš„æ¨¡å‹ï¼š&lt;code>model_name_or_path&lt;/code>ã€‚
&lt;ul>
&lt;li>è¿™é‡Œï¼Œå¡«å†™éœ€è¦è¿›è¡Œå¾®è°ƒçš„æ¨¡å‹ï¼ˆ&lt;code>checkpoint&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>ä¾‹å¦‚ï¼Œå¦‚æœé€‰æ‹©å·²å­˜åœ¨çš„æ£€æŸ¥ç‚¹ï¼š&lt;code>ylacombe/vits-ljs-with-discriminator&lt;/code>ï¼Œæˆ–è€…è½¬æ¢äº†è‡ªå·±çš„æ£€æŸ¥ç‚¹ï¼š&lt;code>&amp;lt;repo-id-you-want&amp;gt;&lt;/code>Â æˆ–Â &lt;code>&amp;lt;local-folder&amp;gt;&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>æ•°æ®é›†ä½¿ç”¨çš„ &lt;code>dataset_name&lt;/code> åŠå…¶è¯¦ç»†ä¿¡æ¯ï¼š&lt;code>dataset_config_name&lt;/code>ã€åˆ—åç­‰ã€‚
&lt;ul>
&lt;li>å¦‚æœæœ‰å¤šä¸ªå£°éŸ³ï¼Œè€Œæ‚¨åªæƒ³ä¿ç•™ä¸€ä¸ªå£°éŸ³ï¼Œè¯·æ³¨æ„Â &lt;code>speaker_id_column_name&lt;/code>ã€&lt;code>override_speaker_embeddings&lt;/code>Â å’ŒÂ &lt;code>filter_on_speaker_id&lt;/code>ã€‚åè€…å…è®¸åªä¿ç•™ä¸€ä¸ªå£°éŸ³ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªå£°éŸ³è¿›è¡Œè®­ç»ƒã€‚&lt;/li>
&lt;li>ä¾‹å¦‚ï¼Œ&lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits/blob/main/training_config_examples/finetune_english.json" target="_blank" rel="noopener"
>&lt;code>finetune_english.json&lt;/code>&lt;/a>Â ä¸­é»˜è®¤ä½¿ç”¨çš„æ•°æ®é›†æ˜¯ British Isles accents æ•°æ®é›†çš„å­é›†ï¼Œä½¿ç”¨Â &lt;code>welsh_female&lt;/code>Â é…ç½®çš„å•ä¸ªå¨å°”å£«å¥³å£°ï¼Œç”±Â &lt;code>speaker_id=5223&lt;/code>Â æ ‡è¯†ã€‚&lt;/li>
&lt;li>å¦‚ä½•æ‰“åŒ…æœ¬åœ°æ•°æ®åˆ°ä¸Šä¼ åˆ° HuggingFace çš„ Datasets è¯·å‚è€ƒæˆ‘å†™çš„ä¸Šä¸€ç¯‡&lt;a class="link" href="https://cyber-blog.github.io/p/dataset-upload2hugginface/" target="_blank" rel="noopener"
>åšå®¢&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è¶…çº§é‡è¦çš„ &lt;code>hyperparameters&lt;/code>â€¼
&lt;ul>
&lt;li>&lt;code>learning_rate&lt;/code>&lt;/li>
&lt;li>&lt;code>batch_size&lt;/code>&lt;/li>
&lt;li>å„ç§æŸå¤±æƒé‡ï¼š&lt;code>weight_duration&lt;/code>ã€&lt;code>weight_kl&lt;/code>ã€&lt;code>weight_mel&lt;/code>ã€&lt;code>weight_disc&lt;/code>ã€&lt;code>weight_gen&lt;/code> ã€&lt;code>weight_fmaps&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥å‚è€ƒæˆ‘è¿›è¡Œå¾®è°ƒçš„é…ç½®æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;project_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vits_finetuned_ind_female&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;push_to_hub&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;hub_model_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dhavalgala/mms-tts-ind-train&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;overwrite_output_dir&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;output_dir&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;./tmp/vits_finetuned_ind_female&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dataset_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Majiang213/ind_famal&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dataset_config_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;audio_column_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;audio&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;text_column_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;text&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;train_split_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;train&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;eval_split_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;train&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;speaker_id_column_name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;speaker_id&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;override_speaker_embeddings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;filter_on_speaker_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;12&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;max_duration_in_seconds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;min_duration_in_seconds&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;max_tokens_length&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;model_name_or_path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dhavalgala/mms-tts-ind-train&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;preprocessing_num_workers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;do_train&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;num_train_epochs&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;gradient_accumulation_steps&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;gradient_checkpointing&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;per_device_train_batch_size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;learning_rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">2e-5&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;adam_beta1&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.8&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;adam_beta2&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.99&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;warmup_ratio&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.01&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;group_by_length&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;do_eval&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;eval_steps&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;per_device_eval_batch_size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;do_step_schedule_per_epoch&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;weight_disc&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;weight_fmaps&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;weight_gen&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;weight_kl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;weight_duration&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;weight_mel&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">35&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;fp16&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;seed&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">456&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æ¨ç†">æ¨ç†
&lt;/h4>&lt;p>åªéœ€å‡ è¡Œä»£ç ï¼Œå³å¯é€šè¿‡æ–‡æœ¬è½¬è¯­éŸ³ ï¼ˆTTSï¼‰ ç®¡é“ä½¿ç”¨å¾®è°ƒçš„æ¨¡å‹ï¼åªéœ€å°†Â &lt;code>ylacombe/vits_ljs_welsh_female_monospeaker_2&lt;/code>Â æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„æ¨¡å‹ ID ï¼ˆ&lt;code>hub_model_id&lt;/code>ï¼‰ æˆ–æ¨¡å‹çš„è·¯å¾„ ï¼ˆ&lt;code>output_dir&lt;/code>ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">transformers&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">pipeline&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">scipy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">model_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;ylacombe/vits_ljs_welsh_female_monospeaker_2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">synthesiser&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pipeline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;text-to-speech&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model_id&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># add device=0 if you want to use a GPU&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">speech&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">synthesiser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Hello, my dog is cooler than you!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">scipy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wavfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;finetuned_output.wav&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rate&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sampling_rate&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;audio&amp;#34;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="é—®é¢˜">é—®é¢˜
&lt;/h4>&lt;p>ç›®å‰åœ¨æ¨ç†æ—¶æœ‰ä¸€ä¸ªå…³äº &lt;code>speaker_id&lt;/code>çš„ä»£ç å…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦å°†&lt;code>run_vits_finetuning.py&lt;/code>æ–‡ä»¶é‡Œçš„æ‰€æœ‰ &lt;code>speaker_id=batch[&amp;quot;speaker_id&amp;quot;]&lt;/code> ä»£ç æ³¨é‡Šæ‰ã€‚
æ³¨é‡Šåå‚è€ƒ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">model_outputs_train&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">input_ids&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">batch&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;input_ids&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">attention_mask&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">batch&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;attention_mask&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">labels&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">batch&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;labels&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">labels_attention_mask&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">batch&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;labels_attention_mask&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># speaker_id=batch[&amp;#34;speaker_id&amp;#34;], &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">return_dict&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">monotonic_alignment_function&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">maximum_path&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ps">PS
&lt;/h4>&lt;ul>
&lt;li>MMS æ˜¯ç”± Vineel Pratapã€Andros Tjandraã€Bowen Shi ç­‰äººåœ¨ã€ŠÂ &lt;a class="link" href="https://arxiv.org/abs/2305.13516" target="_blank" rel="noopener"
>Scaling Speech Technology to 1,000+ Languages&lt;/a>ã€‹ä¸­æå‡ºçš„ã€‚æ‚¨å¯ä»¥åœ¨&lt;a class="link" href="https://dl.fbaipublicfiles.com/mms/misc/language_coverage_mms.html" target="_blank" rel="noopener"
>MMS Language Coverage Overview&lt;/a>ä¸­æ‰¾åˆ°æœ‰å…³å—æ”¯æŒè¯­è¨€åŠå…¶ ISO 639-3 ä»£ç çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶åœ¨ Hugging Face Hub ä¸ŠæŸ¥çœ‹æ‰€æœ‰ MMS-TTS æ£€æŸ¥ç‚¹ï¼š&lt;a class="link" href="https://huggingface.co/models?sort=trending&amp;amp;search=facebook%2Fmms-tts" target="_blank" rel="noopener"
>facebook/mms-tts&lt;/a>ã€‚&lt;/li>
&lt;li>&lt;a class="link" href="https://huggingface.co/docs/transformers/index" target="_blank" rel="noopener"
>Hugging Face ğŸ¤— Transformers&lt;/a> ç”¨äºæ¨¡å‹é›†æˆï¼Œ&lt;a class="link" href="https://huggingface.co/docs/accelerate/index" target="_blank" rel="noopener"
>Hugging Face ğŸ¤— Accelerate&lt;/a> ç”¨äºåˆ†å¸ƒå¼ä»£ç ï¼Œ&lt;a class="link" href="https://huggingface.co/docs/datasets/index" target="_blank" rel="noopener"
>Hugging Face ğŸ¤— datasets&lt;/a>ç”¨äºæ–¹ä¾¿æ•°æ®é›†è®¿é—®ã€‚&lt;/li>
&lt;/ul></description></item><item><title>éŸ³é¢‘æ–‡ä»¶æ‰“åŒ… Dataset ä¸Šä¼  HugginFace</title><link>https://cyber-blog.github.io/p/dataset-upload2hugginface/</link><pubDate>Mon, 01 Jul 2024 00:00:00 +0000</pubDate><author>majiang213@foxmail.com (majiang)</author><guid>https://cyber-blog.github.io/p/dataset-upload2hugginface/</guid><description>&lt;h3 id="æ‰“åŒ…dataset">æ‰“åŒ…Dataset
&lt;/h3>&lt;p>ä¹‹å‰åœ¨ä½¿ç”¨ &lt;a class="link" href="https://github.com/ylacombe/finetune-hf-vits" target="_blank" rel="noopener"
>finetune-hf-vits&lt;/a> é¡¹ç›®å¾®è°ƒ &lt;code>MMS-TTS&lt;/code> çš„å°å°¼è¯­æ¨¡å‹çš„æ—¶å€™ï¼Œè¯¥é¡¹ç›®ä¼šè¯»å– HuggingFace çš„æ•°æ®é›†ï¼Œéœ€è¦å°†æœ¬åœ°çš„æ•°æ®é›†ä¸Šä¼ åˆ° HuggingFaceã€‚
HugginFace çš„æ•°æ®é›†æ˜¯ parquet æ ¼å¼ã€‚å¯ä»¥ä½¿ç”¨ Hugging Face å®˜æ–¹æä¾›çš„åŒ…ç”Ÿæˆã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;your-path&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¯»å– Excel æ–‡ä»¶ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">excel_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;FEMALE VOICE 2 .xlsx&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">excel_file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¤„ç†éŸ³é¢‘è·¯å¾„ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">df&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;audio&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;audio&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">lambda&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">load_audio_file_to_bytes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nb">isinstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è½¬æ¢ DataFrame ä¸ºå­—å…¸æ ¼å¼ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="p">[[&lt;/span>&lt;span class="s1">&amp;#39;text&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;audio&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;speaker_id&amp;#39;&lt;/span>&lt;span class="p">]]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_dict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">orient&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;list&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å®šä¹‰æ•°æ®é›†ç‰¹å¾ï¼Œä½¿ç”¨ Audio ç±»å‹ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">features&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Features&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;text&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;string&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;audio&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Audio&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sampling_rate&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1"># è¿™é‡Œå®šä¹‰éŸ³é¢‘ç‰¹å¾ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;speaker_id&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;string&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»º Dataset å¯¹è±¡ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Dataset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_dict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data_dict&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">features&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿å­˜ä¸º Hugging Face çš„æ•°æ®é›†æ ¼å¼ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">push_to_hub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Majiang213/ind_female&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€šè¿‡ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘çš„æ•°æ®ä¿å­˜æ ¼å¼æ˜¯ä¸€ä¸ª Excel æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ text åˆ—ï¼Œä¸ºéŸ³é¢‘çš„æ–‡æœ¬ï¼Œaudio åˆ—ä¸ºæ–‡ä»¶è·¯å¾„ï¼Œspeaker_id åˆ—ä¸ºå£°éŸ³ idã€‚åœ¨è¯»å– Excel ä¹‹åï¼Œå°†éŸ³é¢‘è·¯å¾„è½¬æ¢ä¸ºäº†å®é™…çš„éŸ³é¢‘æ•°æ®ã€‚ç„¶åå°† &lt;code>Pandas DataFrame&lt;/code> å¯¹è±¡è½¬æ¢ä¸ºäº†ä¸€ä¸ªå­—å…¸ï¼Œé€šè¿‡ Hugging Face åŒ…çš„ &lt;code>Dataset&lt;/code> å¯¹è±¡ï¼Œè¿›è¡Œè½¬æ¢ï¼Œå¹¶ä¸Šä¼ ã€‚&lt;/p>
&lt;p>å¦å¤–ä¸è¦å¿˜è®°ä½¿ç”¨è¯¥å‘½ä»¤ç™»å½•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">huggingface-cli login
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ˜¯è¯»å–éŸ³é¢‘æ•°æ®çš„ä»£ç å’Œéœ€è¦å¼•å…¥çš„åŒ…&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">io&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">librosa&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">pandas&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">pd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">soundfile&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">sf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datasets&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Dataset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Audio&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Features&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pydub&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">AudioSegment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">load_audio_file_to_bytes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">audio_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">audio_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è·å–æ–‡ä»¶æ‰©å±•å &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_extension&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">audio_path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.&amp;#39;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># åˆ›å»ºä¸€ä¸ªå­—èŠ‚æµå¯¹è±¡ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">audio_bytes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BytesIO&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¤„ç†ä¸åŒæ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">file_extension&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;mp3&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;m4a&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä½¿ç”¨ pydub è¯»å– MP3 æˆ– M4A æ–‡ä»¶ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">audio&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">AudioSegment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">format&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">file_extension&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç›´æ¥ä¿å­˜éŸ³é¢‘æ•°æ®åˆ°å­—èŠ‚æµ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">audio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">format&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;wav&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">file_extension&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;wav&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;flac&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ogg&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä½¿ç”¨ librosa ç›´æ¥è¯»å–éŸ³é¢‘æ–‡ä»¶ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">librosa&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å°† NumPy æ•°ç»„è½¬æ¢ä¸º int16 ç±»å‹å¹¶å†™å…¥å­—èŠ‚æµ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">format&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;WAV&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">raise&lt;/span> &lt;span class="ne">ValueError&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Unsupported file format: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">file_extension&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç§»åŠ¨æµçš„æŒ‡é’ˆåˆ°èµ·å§‹ä½ç½®ï¼Œä»¥ä¾¿åç»­è¯»å– &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">audio_bytes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">audio_bytes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getvalue&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ps">PS
&lt;/h4>&lt;p>å¦å¤–æ¨èä¸€ä¸ªå¤„ç†éŸ³é¢‘æ–‡ä»¶çš„ Python å°å·¥å…· &lt;a class="link" href="https://github.com/fishaudio/audio-preprocess" target="_blank" rel="noopener"
>audio-preprocess&lt;/a>ã€‚
è¿™ä¸ª Repo åŒ…å«äº†ä¸€äº›ç”¨äºå¤„ç†éŸ³é¢‘çš„è„šæœ¬. ä¸»è¦åŒ…å«ä»¥ä¸‹åŠŸèƒ½:&lt;/p>
&lt;ul>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â è§†é¢‘/éŸ³é¢‘è½¬ wav&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘äººå£°åˆ†ç¦»&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘è‡ªåŠ¨åˆ‡ç‰‡&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘å“åº¦åŒ¹é…&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘æ•°æ®ç»Ÿè®¡ï¼ˆæ”¯æŒåˆ¤æ–­éŸ³é¢‘é•¿åº¦ï¼‰&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘é‡é‡‡æ ·&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘æ‰“æ ‡ (.lab)&lt;/li>
&lt;li>&lt;input checked="" disabled="" type="checkbox"> Â éŸ³é¢‘æ‰“æ ‡ FunASRï¼ˆä½¿ç”¨Â &lt;code>--model-type funasr&lt;/code>Â å¼€å¯, è¯¦ç»†ä½¿ç”¨æ–¹æ³•å¯æŸ¥çœ‹ä»£ç ï¼‰&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Â éŸ³é¢‘æ‰“æ ‡ WhisperX&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Â .lab æ ‡æ³¨åˆå¹¶ä¸º .list æ–‡ä»¶ (ç¤ºä¾‹:Â &lt;code>fap merge-lab ./dataset list.txt &amp;quot;{PATH}|spkname|JP|{TEXT}&amp;quot;&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>([ ] è¡¨ç¤ºæœªå®Œæˆ, [x] è¡¨ç¤ºå·²å®Œæˆ)&lt;/p>
&lt;h5 id="ä½¿ç”¨æ–¹å¼å‚è€ƒ">ä½¿ç”¨æ–¹å¼å‚è€ƒ
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pip install -e .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fap --help
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>