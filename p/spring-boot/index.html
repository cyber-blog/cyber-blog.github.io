<!doctype html><html lang=zh-ch dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="我最近遇到了一个奇怪的现象：在一个 Java Spring Boot 项目开发中，应用启动时显示了一些日志，然后就完全停止输出，程序看起来像是卡住了。控制台光标在闪烁，但是什么都不会发生。"><title>Spring Boot应用假死现象：SLF4J日志框架冲突深度分析</title>
<link rel=canonical href=https://cyber-blog.github.io/p/spring-boot/><link rel=stylesheet href=/scss/style.min.70a01615b5dd99826a360296920067f6e3896a41fe397d04d6b849efef75a174.css><meta property='og:title' content="Spring Boot应用假死现象：SLF4J日志框架冲突深度分析"><meta property='og:description' content="我最近遇到了一个奇怪的现象：在一个 Java Spring Boot 项目开发中，应用启动时显示了一些日志，然后就完全停止输出，程序看起来像是卡住了。控制台光标在闪烁，但是什么都不会发生。"><meta property='og:url' content='https://cyber-blog.github.io/p/spring-boot/'><meta property='og:site_name' content='仿生人会梦见电子羊吗？'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Java'><meta property='article:tag' content='SpringBoot'><meta property='article:published_time' content='2025-09-19T16:30:00+08:00'><meta property='article:modified_time' content='2025-09-19T16:30:00+08:00'><meta name=twitter:title content="Spring Boot应用假死现象：SLF4J日志框架冲突深度分析"><meta name=twitter:description content="我最近遇到了一个奇怪的现象：在一个 Java Spring Boot 项目开发中，应用启动时显示了一些日志，然后就完全停止输出，程序看起来像是卡住了。控制台光标在闪烁，但是什么都不会发生。"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu9062387157319251782.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🫥</span></figure><div class=site-meta><h1 class=site-name><a href=/>仿生人会梦见电子羊吗？</a></h1><h2 class=site-description>Do Androids Dream of Electric Sheep?</h2></div></header><ol class=menu-social><li><a href=https://github.com/majiang213 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#引言>引言</a><ol><li><a href=#一个令人困惑的现象>一个令人困惑的现象</a></li></ol></li><li><a href=#一当程序卡住的那一刻>一、当程序"卡住"的那一刻</a><ol><li><a href=#初步现象程序似乎停止了>初步现象：程序似乎停止了</a></li></ol></li><li><a href=#二真相往往出人意料>二、真相往往出人意料</a><ol><li><a href=#数字不会说谎567的cpu使用率>数字不会说谎：56.7%的CPU使用率</a></li><li><a href=#深入检查使用各种分析工具>深入检查：使用各种分析工具</a></li></ol></li><li><a href=#三静默杀手的真面目>三、静默杀手的真面目</a><ol><li><a href=#slf4j的选择困难症>SLF4J的选择困难症</a></li><li><a href=#被吞噬的日志去了哪里>被吞噬的日志去了哪里</a></li></ol></li><li><a href=#四破解之道>四、破解之道</a><ol><li><a href=#斩断混乱的依赖链>斩断混乱的依赖链</a></li><li><a href=#为什么会一直使用reald4j>为什么会一直使用reald4j?</a></li></ol></li><li><a href=#尾声技术世界的启示>尾声：技术世界的启示</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/tech/ style=background-color:#2a9d8f;color:#fff>技术博客</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/spring-boot/>Spring Boot应用假死现象：SLF4J日志框架冲突深度分析</a></h2><h3 class=article-subtitle>我最近遇到了一个奇怪的现象：在一个 Java Spring Boot 项目开发中，应用启动时显示了一些日志，然后就完全停止输出，程序看起来像是卡住了。控制台光标在闪烁，但是什么都不会发生。</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 19, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 8 分钟</time></div></footer></div></header><section class=article-content><h2 id=引言>引言</h2><h3 id=一个令人困惑的现象>一个令人困惑的现象</h3><p>我最近遇到了一个奇怪的现象：在一个 Java Spring Boot 项目开发中，应用启动时显示了一些日志，然后就完全停止输出，程序看起来像是卡住了。控制台光标在闪烁，但是什么都不会发生。</p><p>然而，通过排除一个jar包，程序就能正常启动。这让我非常困惑。 为什么排除一个日志相关的依赖就能解决问题？程序真的卡住了吗？</p><p>我将分析我最近遇到的一个真实案例。</p><h2 id=一当程序卡住的那一刻>一、当程序"卡住"的那一刻</h2><h3 id=初步现象程序似乎停止了>初步现象：程序似乎停止了</h3><p>我执行通过IDEA执行<code>mvn spring-boot:run</code> 启动应用时，控制台显示了这些信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>SLF4J</span><span class=p>(</span><span class=n>W</span><span class=p>):</span> <span class=n>Class</span> <span class=n>path</span> <span class=n>contains</span> <span class=n>multiple</span> <span class=n>SLF4J</span> <span class=n>providers</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>SLF4J</span><span class=p>(</span><span class=n>W</span><span class=p>):</span> <span class=n>Found</span> <span class=n>provider</span> <span class=p>[</span><span class=n>org</span><span class=o>.</span><span class=n>slf4j</span><span class=o>.</span><span class=n>reload4j</span><span class=o>.</span><span class=n>Reload4jServiceProvider</span><span class=err>@</span><span class=mi>64</span><span class=n>cd705f</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>SLF4J</span><span class=p>(</span><span class=n>W</span><span class=p>):</span> <span class=n>Found</span> <span class=n>provider</span> <span class=p>[</span><span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>logging</span><span class=o>.</span><span class=n>slf4j</span><span class=o>.</span><span class=n>SLF4JServiceProvider</span><span class=err>@</span><span class=mi>9225652</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>SLF4J</span><span class=p>(</span><span class=n>I</span><span class=p>):</span> <span class=n>Actual</span> <span class=n>provider</span> <span class=n>is</span> <span class=n>of</span> <span class=n>type</span> <span class=p>[</span><span class=n>org</span><span class=o>.</span><span class=n>slf4j</span><span class=o>.</span><span class=n>reload4j</span><span class=o>.</span><span class=n>Reload4jServiceProvider</span><span class=err>@</span><span class=mi>64</span><span class=n>cd705f</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>log4j</span><span class=p>:</span><span class=n>WARN</span> <span class=n>No</span> <span class=n>appenders</span> <span class=n>could</span> <span class=n>be</span> <span class=n>found</span> <span class=k>for</span> <span class=n>logger</span> <span class=p>(</span><span class=n>com</span><span class=o>.</span><span class=n>sankuai</span><span class=o>.</span><span class=n>inf</span><span class=o>.</span><span class=n>octo</span><span class=o>.</span><span class=n>mns</span><span class=o>.</span><span class=n>util</span><span class=o>.</span><span class=n>ProcessInfoUtil</span><span class=p>)</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>log4j</span><span class=p>:</span><span class=n>WARN</span> <span class=n>Please</span> <span class=n>initialize</span> <span class=n>the</span> <span class=n>log4j</span> <span class=n>system</span> <span class=n>properly</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>23.178052</span><span class=n>Z</span> <span class=n>main</span> <span class=n>INFO</span> <span class=n>create</span> <span class=n>XMDFileAppender</span> <span class=p>[</span><span class=n>name</span><span class=o>=</span><span class=n>xmdCraneAppender</span> <span class=n>fullFileName</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>crane</span><span class=o>.</span><span class=n>log</span> <span class=n>appkey</span><span class=o>=</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span> <span class=n>fullFilePattern</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>crane</span><span class=o>.</span><span class=n>log</span><span class=o>-%</span><span class=n>d</span><span class=p>{</span><span class=n>yyyy</span><span class=o>-</span><span class=n>MM</span><span class=o>-</span><span class=n>dd</span><span class=p>}</span><span class=o>-%</span><span class=n>i</span><span class=o>.</span><span class=n>log</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>23.178277</span><span class=n>Z</span> <span class=n>main</span> <span class=n>INFO</span> <span class=n>create</span> <span class=n>XMDFileAppender</span> <span class=p>[</span><span class=n>name</span><span class=o>=</span><span class=n>xmdMafkaAppender</span> <span class=n>fullFileName</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>mafka</span><span class=o>.</span><span class=n>log</span> <span class=n>appkey</span><span class=o>=</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span> <span class=n>fullFilePattern</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>mafka</span><span class=o>.</span><span class=n>log</span><span class=o>-%</span><span class=n>d</span><span class=p>{</span><span class=n>yyyy</span><span class=o>-</span><span class=n>MM</span><span class=o>-</span><span class=n>dd</span><span class=p>}</span><span class=o>-%</span><span class=n>i</span><span class=o>.</span><span class=n>log</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>23.178424</span><span class=n>Z</span> <span class=n>main</span> <span class=n>INFO</span> <span class=n>create</span> <span class=n>XMDFileAppender</span> <span class=p>[</span><span class=n>name</span><span class=o>=</span><span class=n>xmdRhinoAppender</span> <span class=n>fullFileName</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rhino</span><span class=o>.</span><span class=n>log</span> <span class=n>appkey</span><span class=o>=</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span> <span class=n>fullFilePattern</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rhino</span><span class=o>.</span><span class=n>log</span><span class=o>-%</span><span class=n>d</span><span class=p>{</span><span class=n>yyyy</span><span class=o>-</span><span class=n>MM</span><span class=o>-</span><span class=n>dd</span><span class=p>}</span><span class=o>-%</span><span class=n>i</span><span class=o>.</span><span class=n>log</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>23.178563</span><span class=n>Z</span> <span class=n>main</span> <span class=n>INFO</span> <span class=n>create</span> <span class=n>XMDFileAppender</span> <span class=p>[</span><span class=n>name</span><span class=o>=</span><span class=n>xmdKmsAppender</span> <span class=n>fullFileName</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>kms</span><span class=o>.</span><span class=n>log</span> <span class=n>appkey</span><span class=o>=</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span> <span class=n>fullFilePattern</span><span class=o>=/</span><span class=n>data</span><span class=o>/</span><span class=n>applogs</span><span class=o>/</span><span class=n>inf</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>kms</span><span class=o>.</span><span class=n>log</span><span class=o>-%</span><span class=n>d</span><span class=p>{</span><span class=n>yyyy</span><span class=o>-</span><span class=n>MM</span><span class=o>-</span><span class=n>dd</span><span class=p>}</span><span class=o>-%</span><span class=n>i</span><span class=o>.</span><span class=n>log</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>23.183208</span><span class=n>Z</span> <span class=n>main</span> <span class=n>INFO</span> <span class=n>Begin</span> <span class=n>Stop</span> <span class=n>AsyncScibeAppender</span><span class=p>:</span> <span class=n>ScribeAsyncAppender</span> <span class=n>Queue</span> <span class=n>still</span> <span class=n>has</span> <span class=mi>0</span> <span class=n>events</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>23.183676</span><span class=n>Z</span> <span class=n>main</span> <span class=n>INFO</span> <span class=n>End</span> <span class=n>Stop</span> <span class=n>AsyncScibeAppender</span><span class=p>:</span> <span class=n>ScribeAsyncAppender</span> <span class=n>Queue</span> <span class=n>still</span> <span class=n>has</span> <span class=mi>0</span> <span class=n>events</span>
</span></span><span class=line><span class=cl><span class=o>////////////////////////////////////////////////////////////////////</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                          <span class=n>_ooOoo_</span>                               <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                         <span class=n>o8888888o</span>                              <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                         <span class=mi>88</span><span class=s2>&#34; . &#34;</span><span class=mi>88</span>                              <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                         <span class=p>(</span><span class=o>|</span> <span class=o>^</span><span class=n>_</span><span class=o>^</span> <span class=o>|</span><span class=p>)</span>                              <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                         <span class=n>O</span>\  <span class=o>=</span>  <span class=o>/</span><span class=n>O</span>                              <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                      <span class=n>____</span><span class=o>/</span><span class=err>`</span><span class=o>---</span><span class=s1>&#39;\____                           //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                    <span class=o>.</span><span class=s1>&#39;  </span><span class=se>\\</span><span class=s1>|     |//  `.                         //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                   <span class=o>/</span>  \\<span class=o>|||</span>  <span class=p>:</span>  <span class=o>|||//</span>  \                        <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                  <span class=o>/</span>  <span class=n>_</span><span class=o>|||||</span> <span class=o>-</span><span class=p>:</span><span class=o>-</span> <span class=o>|||||-</span>  \                       <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                  <span class=o>|</span>   <span class=o>|</span> \\\  <span class=o>-</span>  <span class=o>///</span> <span class=o>|</span>   <span class=o>|</span>                       <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                  <span class=o>|</span> \<span class=n>_</span><span class=o>|</span>  <span class=s1>&#39;&#39;</span>\<span class=o>---/</span><span class=s1>&#39;&#39;</span>  <span class=o>|</span>   <span class=o>|</span>                       <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                  \  <span class=o>.-</span>\<span class=n>__</span>  <span class=err>`</span><span class=o>-</span><span class=err>`</span>  <span class=n>___</span><span class=o>/-.</span> <span class=o>/</span>                       <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                <span class=n>___</span><span class=err>`</span><span class=o>.</span> <span class=o>.</span><span class=s1>&#39;  /--.--\  `. . ___                     //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>              <span class=o>.</span><span class=s2>&#34;&#34;</span> <span class=s1>&#39;&lt;  `.___\_&lt;|&gt;_/___.&#39;</span>  <span class=o>&gt;</span><span class=s1>&#39;&#34;&#34;.                  //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>            <span class=o>|</span> <span class=o>|</span> <span class=p>:</span>  <span class=err>`</span><span class=o>-</span> \<span class=err>`</span><span class=o>.</span><span class=p>;</span><span class=err>`</span>\ <span class=n>_</span> <span class=o>/</span><span class=err>`</span><span class=p>;</span><span class=o>.</span><span class=err>`</span><span class=o>/</span> <span class=o>-</span> <span class=err>`</span> <span class=p>:</span> <span class=o>|</span> <span class=o>|</span>                 <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>            \  \ <span class=err>`</span><span class=o>-.</span>   \<span class=n>_</span> <span class=n>__</span>\ <span class=o>/</span><span class=n>__</span> <span class=n>_</span><span class=o>/</span>   <span class=o>.-</span><span class=err>`</span> <span class=o>/</span>  <span class=o>/</span>                 <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>      <span class=o>========</span><span class=err>`</span><span class=o>-.</span><span class=n>____</span><span class=err>`</span><span class=o>-.</span><span class=n>___</span>\<span class=n>_____</span><span class=o>/</span><span class=n>___</span><span class=o>.-</span><span class=err>`</span><span class=n>____</span><span class=o>.-</span><span class=s1>&#39;========         //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>                           <span class=err>`</span><span class=o>=---=</span><span class=s1>&#39;                              //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>      <span class=o>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>        <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>            <span class=err>佛祖保佑</span>       <span class=err>永不宕机</span>      <span class=err>永无</span><span class=n>BUG</span>                   <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span>            <span class=n>Thanks</span> <span class=n>to</span> <span class=n>Buddha</span><span class=s1>&#39;s blessing, may our system         //</span>
</span></span><span class=line><span class=cl><span class=o>//</span>            <span class=n>remain</span> <span class=n>stable</span> <span class=ow>and</span> <span class=n>bug</span><span class=o>-</span><span class=n>free</span> <span class=n>forever</span><span class=o>.</span>                 <span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>////////////////////////////////////////////////////////////////////</span>
</span></span><span class=line><span class=cl><span class=mi>9</span><span class=err>月</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>2025</span> <span class=mi>10</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>26</span> <span class=err>上午</span> <span class=n>org</span><span class=o>.</span><span class=n>bouncycastle</span><span class=o>.</span><span class=n>jsse</span><span class=o>.</span><span class=n>provider</span><span class=o>.</span><span class=n>PropertyUtils</span> <span class=n>getStringSecurityProperty</span>
</span></span><span class=line><span class=cl><span class=err>信息</span><span class=p>:</span> <span class=n>Found</span> <span class=n>string</span> <span class=n>security</span> <span class=n>property</span> <span class=p>[</span><span class=n>jdk</span><span class=o>.</span><span class=n>tls</span><span class=o>.</span><span class=n>disabledAlgorithms</span><span class=p>]:</span> <span class=n>SSLv3</span><span class=p>,</span> <span class=n>TLSv1</span><span class=p>,</span> <span class=n>TLSv1</span><span class=o>.</span><span class=mi>1</span><span class=p>,</span> <span class=n>RC4</span><span class=p>,</span> <span class=n>DES</span><span class=p>,</span> <span class=n>MD5withRSA</span><span class=p>,</span> <span class=n>DH</span> <span class=n>keySize</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=p>,</span> <span class=n>EC</span> <span class=n>keySize</span> <span class=o>&lt;</span> <span class=mi>224</span><span class=p>,</span> <span class=mi>3</span><span class=n>DES_EDE_CBC</span><span class=p>,</span> <span class=n>anon</span><span class=p>,</span> <span class=n>NULL</span>
</span></span><span class=line><span class=cl><span class=mi>9</span><span class=err>月</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>2025</span> <span class=mi>10</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>26</span> <span class=err>上午</span> <span class=n>org</span><span class=o>.</span><span class=n>bouncycastle</span><span class=o>.</span><span class=n>jsse</span><span class=o>.</span><span class=n>provider</span><span class=o>.</span><span class=n>PropertyUtils</span> <span class=n>getStringSecurityProperty</span>
</span></span><span class=line><span class=cl><span class=err>信息</span><span class=p>:</span> <span class=n>Found</span> <span class=n>string</span> <span class=n>security</span> <span class=n>property</span> <span class=p>[</span><span class=n>jdk</span><span class=o>.</span><span class=n>certpath</span><span class=o>.</span><span class=n>disabledAlgorithms</span><span class=p>]:</span> <span class=n>MD2</span><span class=p>,</span> <span class=n>MD5</span><span class=p>,</span> <span class=n>SHA1</span> <span class=n>jdkCA</span> <span class=o>&amp;</span> <span class=n>usage</span> <span class=n>TLSServer</span><span class=p>,</span> <span class=n>RSA</span> <span class=n>keySize</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=p>,</span> <span class=n>DSA</span> <span class=n>keySize</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=p>,</span> <span class=n>EC</span> <span class=n>keySize</span> <span class=o>&lt;</span> <span class=mi>224</span><span class=p>,</span> <span class=n>SHA1</span> <span class=n>usage</span> <span class=n>SignedJAR</span> <span class=o>&amp;</span> <span class=n>denyAfter</span> <span class=mi>2019</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span>
</span></span><span class=line><span class=cl><span class=mi>9</span><span class=err>月</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>2025</span> <span class=mi>10</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>26</span> <span class=err>上午</span> <span class=n>org</span><span class=o>.</span><span class=n>bouncycastle</span><span class=o>.</span><span class=n>jsse</span><span class=o>.</span><span class=n>provider</span><span class=o>.</span><span class=n>DisabledAlgorithmConstraints</span> <span class=n>create</span>
</span></span><span class=line><span class=cl><span class=err>警告</span><span class=p>:</span> <span class=n>Ignoring</span> <span class=n>unsupported</span> <span class=n>entry</span> <span class=ow>in</span> <span class=s1>&#39;jdk.certpath.disabledAlgorithms&#39;</span><span class=p>:</span> <span class=n>SHA1</span> <span class=n>jdkCA</span> <span class=o>&amp;</span> <span class=n>usage</span> <span class=n>TLSServer</span>
</span></span><span class=line><span class=cl><span class=mi>9</span><span class=err>月</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>2025</span> <span class=mi>10</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>26</span> <span class=err>上午</span> <span class=n>org</span><span class=o>.</span><span class=n>bouncycastle</span><span class=o>.</span><span class=n>jsse</span><span class=o>.</span><span class=n>provider</span><span class=o>.</span><span class=n>DisabledAlgorithmConstraints</span> <span class=n>create</span>
</span></span><span class=line><span class=cl><span class=err>警告</span><span class=p>:</span> <span class=n>Ignoring</span> <span class=n>unsupported</span> <span class=n>entry</span> <span class=ow>in</span> <span class=s1>&#39;jdk.certpath.disabledAlgorithms&#39;</span><span class=p>:</span> <span class=n>SHA1</span> <span class=n>usage</span> <span class=n>SignedJAR</span> <span class=o>&amp;</span> <span class=n>denyAfter</span> <span class=mi>2019</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span><span class=n>T02</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mf>26.632017</span><span class=n>Z</span> <span class=n>xmdlog</span><span class=o>-</span><span class=n>registry</span><span class=o>-</span><span class=n>service</span> <span class=n>INFO</span> <span class=n>Registry</span> <span class=n>LogManager</span> <span class=n>register</span> <span class=n>status</span> <span class=bp>true</span><span class=p>,</span> <span class=n>url</span> <span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=nb>log</span><span class=o>.</span><span class=n>inf</span><span class=o>.</span><span class=n>dev</span><span class=o>.</span><span class=n>sankuai</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>api</span><span class=o>/</span><span class=n>register</span><span class=err>?</span><span class=n>appkey</span><span class=o>=</span><span class=n>com</span><span class=o>.</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>&amp;</span><span class=n>ip</span><span class=o>=</span><span class=mf>172.18</span><span class=o>.</span><span class=mf>151.200</span><span class=o>&amp;</span><span class=n>port</span><span class=o>=</span><span class=mi>12315</span><span class=o>&amp;</span><span class=n>env</span><span class=o>=</span><span class=n>TEST</span><span class=o>&amp;</span><span class=n>version</span><span class=o>=</span><span class=mf>2.2</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Local</span> <span class=n>Appenv</span><span class=p>:</span> <span class=n>deployenv</span> <span class=p>[</span><span class=n>qa</span><span class=p>],</span> <span class=n>env</span> <span class=p>[</span><span class=n>test</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>AppEnv</span><span class=p>{</span><span class=n>deployenv</span><span class=o>=</span><span class=s1>&#39;qa&#39;</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=s1>&#39;test&#39;</span><span class=p>,</span> <span class=n>swimlane</span><span class=o>=</span><span class=s1>&#39;tmp-test&#39;</span><span class=p>,</span> <span class=n>cell</span><span class=o>=</span><span class=s1>&#39;null&#39;</span><span class=p>,</span> <span class=n>grouptags</span><span class=o>=</span><span class=s1>&#39;null&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Fri</span> <span class=n>Sep</span> <span class=mi>19</span> <span class=mi>10</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>48</span> <span class=n>CST</span> <span class=mi>2025</span> <span class=n>WARN</span><span class=p>:</span> <span class=n>Establishing</span> <span class=n>SSL</span> <span class=n>connection</span> <span class=n>without</span> <span class=n>server</span><span class=s1>&#39;s identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn&#39;</span><span class=n>t</span> <span class=n>set</span><span class=o>.</span> <span class=n>For</span> <span class=n>compliance</span> <span class=n>with</span> <span class=n>existing</span> <span class=n>applications</span> <span class=ow>not</span> <span class=n>using</span> <span class=n>SSL</span> <span class=n>the</span> <span class=n>verifyServerCertificate</span> <span class=n>property</span> <span class=n>is</span> <span class=n>set</span> <span class=n>to</span> <span class=s1>&#39;false&#39;</span><span class=o>.</span> <span class=n>You</span> <span class=n>need</span> <span class=n>either</span> <span class=n>to</span> <span class=n>explicitly</span> <span class=n>disable</span> <span class=n>SSL</span> <span class=n>by</span> <span class=n>setting</span> <span class=n>useSSL</span><span class=o>=</span><span class=bp>false</span><span class=p>,</span> <span class=ow>or</span> <span class=n>set</span> <span class=n>useSSL</span><span class=o>=</span><span class=bp>true</span> <span class=ow>and</span> <span class=n>provide</span> <span class=n>truststore</span> <span class=k>for</span> <span class=n>server</span> <span class=n>certificate</span> <span class=n>verification</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><p>在显示了一些组件初始化信息和ASCII图案后，程序就完全停止输出了。控制台光标在闪烁，但是什么都不会发生。</p><h2 id=二真相往往出人意料>二、真相往往出人意料</h2><h3 id=数字不会说谎567的cpu使用率>数字不会说谎：56.7%的CPU使用率</h3><p>首先使用 <code>ps</code> 命令查看进程信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ps aux <span class=p>|</span> grep ApplicationLoader
</span></span><span class=line><span class=cl>majiang    <span class=m>97897</span>  56.7  2.5 <span class=m>443940128</span> <span class=m>633216</span>   ??  R    11:34AM   1:19.25
</span></span></code></pre></td></tr></table></div></div><p>这个结果让我震惊：</p><ul><li>进程状态: R (Running) — 程序在运行，不是阻塞状态</li><li>CPU使用率: 56.7% — 程序在积极工作</li><li>运行时间: 1小时19分钟 — 程序一直在持续运行</li></ul><p>我原本以为程序卡住了，如果真是这样，CPU使用率应该接近0%。但现在56.7%的CPU使用率说明程序在正常运行！</p><h3 id=深入检查使用各种分析工具>深入检查：使用各种分析工具</h3><p>为了彻底搞清楚程序在做什么，我使用了多种分析手段：</p><p>线程状态分析: 使用<code>jstack</code>反复检查，没有发现死锁或异常阻塞</p><ul><li><p>Profiler火焰图: 通过JProfiler查看方法调用，程序执行正常</p></li><li><p>线程时间线: 观察线程的时间分布，各个线程都在正常工作</p></li><li><p>线程快照: 多次获取线程快照对比，线程状态正常工作</p><p>所有这些工具都指向同一个结论：程序运行完全正常，没有任何阻塞或性能问题。</p><p>进一步分析线程堆栈，我发现了关键信息：</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  $ jstack <span class=m>97897</span> <span class=p>|</span> grep -E <span class=s2>&#34;main.*tid&#34;</span>
</span></span><span class=line><span class=cl>  <span class=c1># 没有找到main线程！</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  $ jstack <span class=m>97897</span> <span class=p>|</span> head -20
</span></span><span class=line><span class=cl>  <span class=s2>&#34;qtp1366921090-106&#34;</span> <span class=c1>#106 prio=5 ... waiting on condition</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;qtp1366921090-107&#34;</span> <span class=c1>#107 prio=5 ... runnable  </span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;RhinoHttpSeverBossGroup-2-1&#34;</span> <span class=c1>#128 prio=5 ... runnable</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;MtthriftServerBossGroup-8-1&#34;</span> <span class=c1>#346 prio=5 ... runnable</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;DestroyJavaVM&#34;</span> <span class=c1>#377 prio=5 ... waiting on condition</span>
</span></span></code></pre></td></tr></table></div></div><p>这些发现彻底改变了我的认知：</p><ul><li>✅ Main线程已经正常执行完毕并退出</li><li>✅ Spring Boot应用完全启动成功</li><li>✅ HTTP服务器线程池（qtp开头的线程）在正常运行</li><li>✅ 各种服务组件的工作线程都在运行</li></ul><p>程序根本没有"卡住"！</p><p>真正发生的是：应用在后台正常运行，但是没有任何日志输出。这给我造成了程序停止响应的错觉。</p><p>问题的本质从"程序阻塞"变成了"日志系统失效"。</p><h2 id=三静默杀手的真面目>三、静默杀手的真面目</h2><h3 id=slf4j的选择困难症>SLF4J的选择困难症</h3><p>既然程序正常运行但没有日志输出，问题就出在日志系统上。回看最初的警告信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl>  <span class=n>SLF4J</span><span class=p>(</span><span class=n>W</span><span class=p>):</span> <span class=n>Class</span> <span class=n>path</span> <span class=n>contains</span> <span class=n>multiple</span> <span class=n>SLF4J</span> <span class=n>providers</span><span class=o>.</span>
</span></span><span class=line><span class=cl>  <span class=n>SLF4J</span><span class=p>(</span><span class=n>W</span><span class=p>):</span> <span class=n>Found</span> <span class=n>provider</span> <span class=p>[</span><span class=n>org</span><span class=o>.</span><span class=n>slf4j</span><span class=o>.</span><span class=n>reload4j</span><span class=o>.</span><span class=n>Reload4jServiceProvider</span><span class=err>@</span><span class=mi>64</span><span class=n>cd705f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>SLF4J</span><span class=p>(</span><span class=n>W</span><span class=p>):</span> <span class=n>Found</span> <span class=n>provider</span> <span class=p>[</span><span class=n>org</span><span class=o>.</span><span class=n>apache</span><span class=o>.</span><span class=n>logging</span><span class=o>.</span><span class=n>slf4j</span><span class=o>.</span><span class=n>SLF4JServiceProvider</span><span class=err>@</span><span class=mi>9225652</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>SLF4J</span><span class=p>(</span><span class=n>I</span><span class=p>):</span> <span class=n>Actual</span> <span class=n>provider</span> <span class=n>is</span> <span class=n>of</span> <span class=n>type</span> <span class=p>[</span><span class=n>org</span><span class=o>.</span><span class=n>slf4j</span><span class=o>.</span><span class=n>reload4j</span><span class=o>.</span><span class=n>Reload4jServiceProvider</span><span class=err>@</span><span class=mi>64</span><span class=n>cd705f</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>这里揭示了关键问题：<strong>SLF4J在两个日志实现之间选择了错误的那个</strong>。</p><p><code>SLF4J</code>是一个日志门面，它在运行时从classpath中选择一个具体的日志实现。选择策略很简单：使用第一个发现的提供者。</p><p><strong>两个冲突的提供者</strong>：</p><ul><li><code>org.slf4j.reload4j.Reload4jServiceProvider</code> — 来自<code>slf4j-reload4j</code>包，兼容Log4j 1.x</li><li><code>org.apache.logging.slf4j.SLF4JServiceProvider</code> — 来自<code>log4j-slf4j2-impl</code>包，支持Log4j 2.x</li></ul><p>SLF4J选择了reload4j提供者，但我的项目配置的是Log4j 2.x格式。</p><h3 id=被吞噬的日志去了哪里>被吞噬的日志去了哪里</h3><p>我的项目使用的是标准的Log4j 2.x配置文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>status=</span><span class=s>&#34;info&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appenders&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;Console</span> <span class=na>name=</span><span class=s>&#34;Console&#34;</span> <span class=na>target=</span><span class=s>&#34;SYSTEM_OUT&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;PatternLayout</span> <span class=na>pattern=</span><span class=s>&#34;${sys:CONSOLE_LOG_PATTERN}&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/Console&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;XMDFile</span> <span class=na>name=</span><span class=s>&#34;infoAppender&#34;</span> <span class=na>fileName=</span><span class=s>&#34;info.log&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- Log4j 2.x特有的appender --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/XMDFile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/appenders&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;loggers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;Console&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/loggers&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>问题在于：reload4j只能理解Log4j 1.x的配置格式，无法解析Log4j 2.x的高级语法。</p><p>失败链路：</p><ol><li>reload4j尝试解析log4j2.xml</li><li>遇到不认识的<code>&lt;XMDFile></code>等Log4j 2.x元素</li><li>配置解析失败，没有创建任何appender</li><li>所有日志调用都被静默丢弃</li></ol><p>这就是为什么会出现这个警告：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>log4j:WARN No appenders could be found for logger (com.sankuai.inf.octo.mns.util.ProcessInfoUtil).
</span></span><span class=line><span class=cl>log4j:WARN Please initialize the log4j system properly.
</span></span></code></pre></td></tr></table></div></div><p>完整的"吞噬"过程：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>  第1步: 业务代码调用
</span></span><span class=line><span class=cl>  logger.info<span class=o>(</span><span class=s2>&#34;Spring Boot application started&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  第2步: SLF4J门面接收调用
</span></span><span class=line><span class=cl>  org.slf4j.Logger.info<span class=o>(</span>String msg<span class=o>)</span>
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  第3步: SLF4J路由到选中的提供者
</span></span><span class=line><span class=cl>  SLF4J → org.slf4j.reload4j.Reload4jLoggerAdapter
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  第4步: reload4j适配器委托给Log4j 1.x
</span></span><span class=line><span class=cl>  Reload4jLoggerAdapter → org.apache.log4j.Logger <span class=o>(</span>reload4j实现<span class=o>)</span>
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  第5步: Log4j检查可用的appender
</span></span><span class=line><span class=cl>  logger.getAllAppenders<span class=o>()</span> → 返回空集合 <span class=o>(</span>因为配置解析失败<span class=o>)</span>
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  第6步: 没有appender可用
</span></span><span class=line><span class=cl>  Log4j判断：既然没有appender，就直接丢弃这条消息
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  第7步: 静默返回
</span></span><span class=line><span class=cl>  方法正常返回，不抛异常，业务代码继续执行
</span></span><span class=line><span class=cl>      ↓
</span></span><span class=line><span class=cl>  结果: 用户完全看不到任何日志输出
</span></span></code></pre></td></tr></table></div></div><p>Log4j采用"静默失败"策略：当没有可用的appender时，所有日志调用正常执行但输出被完全丢弃，不会抛出异常影响业务逻辑。</p><p>这就是为什么排除slf4j-reload4j能解决问题：去掉错误的提供者后，SLF4J会选择正确的Log4j 2.x实现，日志系统恢复正常。</p><h2 id=四破解之道>四、破解之道</h2><h3 id=斩断混乱的依赖链>斩断混乱的依赖链</h3><p>理解了问题本质后，解决方案就很清楚了：<strong>消除SLF4J提供者冲突</strong>。</p><p>通过Maven依赖排除，将错误的提供者从classpath中移除：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>com.sankuai.com<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>example-sdk<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;exclusions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;exclusion&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>slf4j-reload4j<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.slf4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/exclusion&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/exclusions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>修复后的效果：</p><ol><li>Classpath中只剩下log4j-slf4j2-impl提供者</li><li>SLF4J自动选择Log4j 2.x实现</li><li>Log4j 2.x正确解析log4j2.xml配置文件</li><li>Console和File appender正常创建</li><li>日志输出恢复正常，应用"复活"</li></ol><p>验证修复结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>2025-09-19 10:37:00.840  INFO 62045 --- [           main] c.s.h.g.g.ApplicationLoader              : Starting ApplicationLoader using Java 17.0.10
</span></span><span class=line><span class=cl>2025-09-19 10:37:00.840  INFO 62045 --- [           main] c.s.h.g.g.ApplicationLoader              : The following 1 profile is active: &#34;test&#34;
</span></span><span class=line><span class=cl>2025-09-19 10:37:15.234  INFO 62045 --- [           main] c.s.h.g.g.ApplicationLoader              : Started ApplicationLoader in 14.628 seconds
</span></span></code></pre></td></tr></table></div></div><p>没有了SLF4J警告信息，没有了log4j的错误提示，一切都恢复正常。</p><h3 id=为什么会一直使用reald4j>为什么会一直使用reald4j?</h3><p>通过查看项目的pom.xml文件，我发现<code>photo-thrift-client</code>依赖的位置确实影响了SLF4J提供者的选择。</p><p>在<code>hrmdm-globaldata-gateway-infrastructure/pom.xml</code>中，<code>photo-thrift-client</code>依赖位于：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>com.sankuai.com<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>example-sdk<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;exclusions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;exclusion&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>slf4j-reload4j<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.slf4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/exclusion&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/exclusions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这个依赖在文件中的位置相对较前，而且它直接引入了slf4j-reload4j作为传递依赖。由于Maven构建classpath时按照依赖在文件中的声明顺序，slf4j-reload4j的ServiceProvider文件被先加载到ServiceLoader中。</p><p>具体的加载顺序：</p><ol><li>Maven解析依赖树，photo-thrift-client较早被处理</li><li>photo-thrift-client → slf4j-reload4j 被添加到classpath靠前位置</li><li>ServiceLoader扫描时，先发现slf4j-reload4j的ServiceProvider</li><li>SLF4J选择第一个发现的提供者：reload4j</li></ol><p>这就是为什么slf4j-reload4j被优先选择的根本原因。不同的项目中，如果依赖声明顺序不同，可能就会选择log4j-slf4j2-impl作为提供者。</p><p>验证方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mvn dependency:build-classpath
</span></span></code></pre></td></tr></table></div></div><p>可以查看实际构建的classpath顺序，确认slf4j-reload4j确实在前面。</p><h2 id=尾声技术世界的启示>尾声：技术世界的启示</h2><p>这个案例揭示了现代Java应用生态的复杂性。一个看似无害的传递依赖，通过微妙的类加载顺序和配置不匹配，导致了整个日志系统的静默失效。</p><p><strong>表象具有欺骗性</strong>。当我最初看到程序"卡住"时，直觉告诉我这是一个阻塞或死锁问题。但深入分析后发现，程序运行完全正常，问题出在一个完全不同的地方。</p><p><strong>工具是解决问题的关键</strong>。通过系统命令（ps、jstack）和分析工具，我能够透过现象看到本质，发现程序实际在正常运行。</p><p><strong>依赖管理的重要性</strong>。在现代Java项目中，传递依赖可能带来意想不到的问题。一个小小的jar包冲突，就能让整个应用的行为变得诡异。</p><p><strong>静默失败的双刃剑</strong>。Log4j的静默失败设计保护了业务逻辑，但也让问题变得更难发现。有时候，适当的"噪音"比安静的错误更有价值。</p><p>最重要的是：<strong>不要被第一印象误导</strong>。技术问题往往比表面现象更复杂，也更有趣。当遇到无法理解的现象时，保持好奇心，深入挖掘，往往会发现令人惊喜的真相。</p><p>在复杂的技术世界里，最神秘的故障背后，可能隐藏着最简单的原理。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/java/>Java</a>
<a href=/tags/springboot/>SpringBoot</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/jmm/><div class=article-details><h2 class=article-title>JMM</h2></div></a></article><article><a href=/p/java-threadpool-details/><div class=article-details><h2 class=article-title>Java 线程池详解</h2></div></a></article><article class=has-image><a href=/p/macos-compile-jdk/><div class=article-image><img src=/p/macos-compile-jdk/cover.d8f98d9cdcab2d81119d3bc9a8cc0637_hu14915730041950517836.png width=250 height=150 loading=lazy alt="Featured image of post MacOS自行编译JDK" data-key=macos-compile-jdk data-hash="md5-2PmNnNyrLYERnTvJqMwGNw=="></div><div class=article-details><h2 class=article-title>MacOS自行编译JDK</h2></div></a></article><article class=has-image><a href=/p/jvm-gc/><div class=article-image><img src=/p/jvm-gc/cover.d7fdf486c2292738721f5a0634fe8d0b_hu2418473007337000530.png width=250 height=150 loading=lazy alt="Featured image of post JVM自动内存管理和垃圾回收" data-key=jvm-gc data-hash="md5-1/30hsIpJzhyH1oGNP6NCw=="></div><div class=article-details><h2 class=article-title>JVM自动内存管理和垃圾回收</h2></div></a></article><article><a href=/p/database-index/><div class=article-details><h2 class=article-title>MySQL InnoDB 索引机制与优化</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//majiang.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 仿生人会梦见电子羊吗？</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>